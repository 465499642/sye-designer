/*
* System Designer
* https://system-designer.github.io
* @ecarriou
*
* Copyright 2016 Erwan Carriou
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
runtime.on("ready",function(){var a=this.system("design"),b=this.require("DialogImport");b.on("init",function(a){var b="",c=null;$(".modal-backdrop").remove(),$("#designer-dialog-import").empty(),b=this.require("dialog-modal-import.html"),document.querySelector("#designer-dialog-import").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-import-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-import-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),b.on("show",function(){$("#designer-dialog-import-modal").modal("show")}),b.on("hide",function(){$("#designer-dialog-import-modal").modal("hide")});var c=this.require("DialogCheck");c.on("init",function(a){var b="",c=null;$("#designer-dialog-check").empty(),b=this.require("dialog-modal-check.html"),document.querySelector("#designer-dialog-check").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-check-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),c.on("show",function(){$("#designer-dialog-check-modal").modal("show")}),c.on("hide",function(){$("#designer-dialog-check-modal").modal("hide")}),c.on("ok",function(){this.hide()});var d=this.require("DialogWelcome");d.on("init",function(a){var b="",c=null;$("#designer-dialog-welcome").empty(),b=this.require("dialog-modal-welcome.html"),document.querySelector("#designer-dialog-welcome").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-welcome-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),d.on("show",function(){$("#designer-dialog-welcome-modal").modal("show")}),d.on("hide",function(){$("#designer-dialog-welcome-modal").modal("hide")});var e=this.require("DialogSync");e.on("init",function(a){var b="",c=null;$("#designer-dialog-sync").empty(),b=this.require("dialog-modal-sync.html"),document.querySelector("#designer-dialog-sync").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-sync-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this)),c=document.getElementById("designer-dialog-sync-commit"),c.addEventListener("click",function(a){$("#designer-dialog-sync-comments-area").show()}.bind(this)),c=document.getElementById("designer-dialog-sync-refresh"),c.addEventListener("click",function(a){$("#designer-dialog-sync-comments-area").hide()}.bind(this))}),e.on("show",function(){$("#designer-dialog-sync-modal").modal("show")}),e.on("hide",function(){$("#designer-dialog-sync-modal").modal("hide")});var f=this.require("DialogShare");f.on("init",function(a){var b=null,c=null,d="";$("#designer-dialog-share").empty(),d=this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0],b=this.require("dialog-modal-share.html"),document.querySelector("#designer-dialog-share").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,window.location.toString().split("#")[0]+"?system="+encodeURIComponent(JSON.stringify(d)))),c=document.getElementById("designer-dialog-share-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-share-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),f.on("show",function(){$("#designer-dialog-share-modal").modal("show")}),f.on("hide",function(){$("#designer-dialog-share-modal").modal("hide")});var g=this.require("DialogCopyright");g.on("init",function(a){var b="",c=null;$("#designer-dialog-copyright").empty(),b=this.require("dialog-modal-copyright.html"),document.querySelector("#designer-dialog-copyright").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-copyright-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),g.on("show",function(){$("#designer-dialog-copyright-modal").modal("show")}),g.on("hide",function(){$("#designer-dialog-copyright-modal").modal("hide")});var h=this.require("DialogConfig");h.on("init",function(a){var b="",c=null,d=this,e=null;d.require("designer");$("#designer-dialog-config").empty(),b=this.require("dialog-modal-config.html"),document.querySelector("#designer-dialog-config").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),e=this.require("storage").get("system-designer-config"),e||(e={}),"undefined"==typeof e.debugType&&(e.debugType="client",this.require("storage").set("system-designer-config",e)),"client"===e.debugType?($("#designer-dialog-config-radio-client").attr("checked",!0),$("#designer-dialog-config-server-form").hide()):($("#designer-dialog-config-radio-server").attr("checked",!0),$("#designer-dialog-config-client-form").hide()),e.urlClient&&($("#designer-dialog-config-url-client")[0].value=e.urlClient),e.urlServer&&($("#designer-dialog-config-url-server")[0].value=e.urlServer),e.githubToken&&($("#designer-dialog-config-github-token")[0].value=atob(e.githubToken)),e.githubRepository&&($("#designer-dialog-config-github-repository")[0].value=e.githubRepository),c=document.getElementById("designer-dialog-config-radio-client"),c.addEventListener("click",function(a){var b=this.require("storage").get("system-designer-config");b||(b={}),b.debugType="client",this.require("storage").set("system-designer-config",b),$("#designer-dialog-config-client-form").show(),$("#designer-dialog-config-server-form").hide()}.bind(this)),c=document.getElementById("designer-dialog-config-radio-server"),c.addEventListener("click",function(a){var b=this.require("storage").get("system-designer-config");b||(b={}),b.debugType="server",this.require("storage").set("system-designer-config",b),$("#designer-dialog-config-client-form").hide(),$("#designer-dialog-config-server-form").show()}.bind(this)),c=document.getElementById("designer-dialog-config-url-client"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-config-url-client").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-config-github-token"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-config-github-token").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-config-github-repository"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-config-github-repository").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-config-url-server"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-config-url-server").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-config-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-config-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),h.on("show",function(){$("#designer-dialog-config-modal").modal("show")}),h.on("hide",function(){$("#designer-dialog-config-modal").modal("hide")}),h.on("ok",function(){var a=this.require("storage").get("system-designer-config");a||(a={}),a.urlClient=$("#designer-dialog-config-url-client")[0].value,a.urlServer=$("#designer-dialog-config-url-server")[0].value,a.githubToken=btoa($("#designer-dialog-config-github-token")[0].value),a.githubRepository=$("#designer-dialog-config-github-repository")[0].value,this.require("storage").set("system-designer-config",a)});var j=this.require("DialogImportFile");j.on("init",function(a){var b="",c=null,d=this,e=[],f="",g=0,h=0,i="";for($("#designer-dialog-import-file").empty(),e=this.require("db").collections().JSON.find(),g=e.length,h=0;h<g;h++)f=this.require(e[h]._id),i=i+'<a class="list-group-item" id="designer-dialog-import-file-modal-library-'+f.id()+'"><h4 class="list-group-item-heading">'+JSON.parse(decodeURIComponent(f.source())).description+'</h4><p class="list-group-item-text">v'+JSON.parse(decodeURIComponent(f.source())).version+"</p></a>";b=this.require("dialog-modal-import-file.html"),document.querySelector("#designer-dialog-import-file").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{library}}/gi,i));var j=function(a){var b="",c=null,e=0,f=0;if($(this).hasClass("active"))$(this).removeClass("active"),d.data(null);else{for(b=this.getAttribute("id").replace("designer-dialog-import-file-modal-library-",""),d.data(JSON.parse(decodeURIComponent(d.require(b).source()))),c=document.getElementById("designer-dialog-import-file-modal-library"),e=c.children.length,f=0;f<e;f++)$(c.children[f]).removeClass("active");$(this).addClass("active")}};for(h=0;h<g;h++)f=this.require(e[h]._id),c=document.getElementById("designer-dialog-import-file-modal-library-"+f.id()),c.addEventListener("click",j);c=document.getElementById("designer-dialog-import-modal-from-file"),c.addEventListener("click",function(a){$("#designer-dialog-import-modal-from-file-form").show(),$("#designer-dialog-import-modal-from-library-form").hide()}.bind(this)),c=document.getElementById("designer-dialog-import-modal-from-library"),c.addEventListener("click",function(a){$("#designer-dialog-import-modal-from-library-form").show(),$("#designer-dialog-import-modal-from-file-form").hide()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-merge"),c.addEventListener("click",function(a){this.mergeSystem()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-import"),c.addEventListener("click",function(a){this.importSystem()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-file"),c.addEventListener("change",function(a){a.stopPropagation(),a.preventDefault();var b=a.target.files,c=new FileReader,d="",e=this;c.onload=function(a){d+=a.target.result},c.onloadend=function(){try{e.data(JSON.parse(d))}catch(a){e.data({})}},c.readAsText(b[0],"UTF-8")}.bind(this))}),j.on("show",function(){$("#designer-dialog-import-file-modal").modal("show")}),j.on("hide",function(){$("#designer-dialog-import-file-modal").modal("hide")});var k=this.require("DialogDropFile");k.on("init",function(a){var b=null,c=null;$("#designer-dialog-drop-file").empty(),b=this.require("dialog-modal-drop-file.html"),document.querySelector("#designer-dialog-drop-file").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-drop-file-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-drop-file-modal-merge"),c.addEventListener("click",function(a){this.mergeSystem()}.bind(this)),c=document.getElementById("designer-dialog-drop-file-modal-import"),c.addEventListener("click",function(a){this.importSystem()}.bind(this))}),k.on("mergeSystem",function(){function a(a){var b="",c="";for(c in l.system().models())if(l.system().models()[c]._name===a){b=c;break}return b}function b(a){var b="",c="";for(c in l.system().schemas())if(l.system().schemas()[c]._name===a){b=c;break}return b}function c(a,b,c){var d={},e="",f=!1;for(e in c)if(d=c[e],d.component===a&&d.state===b){f=!0;break}return f}function d(a,d,e,f){var g={},h="",i=!0;return h=b(f.component),g=d[h],g&&"method"===g[f.state]&&(i=!c(f.component,f.state,e)),"main"===f.state&&f.component===a&&(i=!1),i}var e=null,f="",g="",h="",i="",j="",k="",l=this.require("designer"),m={},n={},o={},p={},q={},r=(l.system(),this.require("message"));if(e=this.data(),Object.keys(e).length){q=JSON.parse(JSON.stringify(l.system().behaviors())),m=JSON.parse(JSON.stringify(l.system().schemas()));for(f in e.behaviors)f!==e._id&&d(e._id,m,q,e.behaviors[f])&&(q[f]=e.behaviors[f]);l.system().behaviors(q),m=JSON.parse(JSON.stringify(l.system().schemas()));for(f in e.schemas)if(m[f])for(h in e.schemas[f])m[f][h]=e.schemas[f][h];else if(b(e.schemas[f]._name))for(h in e.schemas[f])0!==h.indexOf("_")&&(m[b(e.schemas[f]._name)][h]=e.schemas[f][h]);else m[f]=e.schemas[f];for(k in m)l.syncModel(m[k]);n=JSON.parse(JSON.stringify(l.system().models()));for(f in e.models)if(n[f])for(h in e.models[f])n[f][h]=e.models[f][h];else if(a(e.models[f]._name))for(h in e.models[f])0!==h.indexOf("_")&&(n[a(e.models[f]._name)][h]=e.models[f][h]);else n[f]=e.models[f];for(j in n)l.syncBehavior(n[j]);o=JSON.parse(JSON.stringify(l.system().types()));for(f in e.types)if(o[f])for(h in e.types[f])o[f][h]=e.types[f][h];else o[f]=e.types[f];p=JSON.parse(JSON.stringify(l.system().components()));for(g in e.components){p[g]||(p[g]={});for(i in e.components[g])if(p[g][i])for(h in e.components[g][i])p[g][i][h]=e.components[g][i][h];else p[g][i]=e.components[g][i]}l.system().components(p);for(j in n)l.syncComponent(n[j]);l.system().schemas(m),l.system().models(n),l.system().types(o),l.system().behaviors(q),l.system().components(p),l.save(),l.spaces().render(),l.workspace().refresh(),l.updateRouter(),this.hide(),r.success("composition of the system is done.")}else r.danger("the system you try to import is invalid.")}),k.on("importSystem",function(){var a=this.require("System"),b=null,c=this.require("designer"),d=this.require("message");c.system()&&c.system().destroy(),b=new a(this.data()),c.system(b),c.logs().forEach(function(a){this.logs().pop()}.bind(c)),c.save(),c.space(b.name()),c.spaces().render(),c.workspace().refresh(),c.updateRouter(),this.hide(),c.save(),d.success("importation of the system is done.")}),k.on("show",function(){$("#designer-dialog-drop-file-modal").modal("show")}),k.on("hide",function(){$("#designer-dialog-drop-file-modal").modal("hide")});var l=this.require("DialogTypeCreation");l.on("init",function(a){var b="",c=null;$("#designer-dialog-type-creation").empty(),b=this.require("dialog-modal-type-creation.html"),document.querySelector("#designer-dialog-type-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-type-creation-name"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-type-creation-name").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-type-creation-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-type-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this)),$("#designer-dialog-type-creation-modal").on("shown.bs.modal",function(){$("#designer-dialog-type-creation-name").focus()})}),l.on("show",function(){$("#designer-dialog-type-creation-modal").modal("show")}),l.on("hide",function(){$("#designer-dialog-type-creation-modal").modal("hide")});var m=this.require("DialogExport");m.on("init",function(a){var b="",c=null,d=this.require("designer").system();$("#designer-dialog-export").empty(),b=this.require("dialog-modal-export.html"),document.querySelector("#designer-dialog-export").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),d.master()===!0&&$("#designer-dialog-export-isMaster").attr("checked",!0),d.subsystem()===!0&&$("#designer-dialog-export-isSubsystem").attr("checked",!0),c=document.getElementById("designer-dialog-export-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-export-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this)),c=document.getElementById("designer-dialog-export-json"),c.addEventListener("click",function(a){$("#designer-dialog-export-options").show()}.bind(this)),c=document.getElementById("designer-dialog-export-html"),c.addEventListener("click",function(a){$("#designer-dialog-export-options").hide()}.bind(this)),c=document.getElementById("designer-dialog-export-node"),c.addEventListener("click",function(a){$("#designer-dialog-export-options").hide()}.bind(this)),c=document.getElementById("designer-dialog-export-modal"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),this.ok(),!1}.bind(this))}),m.on("show",function(){$("#designer-dialog-export-modal").modal("show")}),m.on("hide",function(){$("#designer-dialog-export-modal").modal("hide")});var n=this.require("DialogSchemaCreation");n.on("init",function(a){var b="",c=null;$("#designer-dialog-schema-creation").empty(),b=this.require("dialog-modal-schema-creation.html"),document.querySelector("#designer-dialog-schema-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-schema-creation-name"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-schema-creation-name").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-schema-creation-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-schema-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this)),$("#designer-dialog-schema-creation-modal").on("shown.bs.modal",function(){$("#designer-dialog-schema-creation-name").focus()})}),n.on("show",function(){$("#designer-dialog-schema-creation-modal").modal("show")}),n.on("hide",function(){$("#designer-dialog-schema-creation-modal").modal("hide")});var o=this.require("DialogSystemCreation");o.on("init",function(a){var b="",c=null;$("#designer-dialog-system-creation").empty(),b=this.require("dialog-modal-system-creation.html"),document.querySelector("#designer-dialog-system-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-system-creation-name"),c.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-system-creation-name").val()&&this.ok(),!1}.bind(this)),c=document.getElementById("designer-dialog-system-creation-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-system-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this)),$("#designer-dialog-system-creation-modal").on("shown.bs.modal",function(){$("#designer-dialog-system-creation-name").focus()})}),o.on("show",function(){$("#designer-dialog-system-creation-modal").modal("show")}),o.on("hide",function(){$("#designer-dialog-system-creation-modal").modal("hide")});var p=this.require("DialogModelCreation");p.on("init",function(a){var b="",c=null;$("#designer-dialog-model-creation").empty(),b=this.require("dialog-modal-model-creation.html"),document.querySelector("#designer-dialog-model-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-model-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),p.on("show",function(){$("#designer-dialog-model-creation-modal").modal("show")}),p.on("hide",function(){$("#designer-dialog-model-creation-modal").modal("hide")});var q=this.require("DialogBehaviorCreation");q.on("init",function(a){function b(a){var b="",c="";for(c in g.system().schemas())if(g.system().schemas()[c]._name===a){b=c;break}return b}var c="",d=null,e="",f=[],g=this.require("designer"),h=this.require("designer").space(),i=(g.system().schemas(),g.system().models(),""),j="";if($("#designer-dialog-behavior-creation").empty(),h!==g.system().name()){i=b(h),f.push("init"),f.push("destroy");for(j in g.system().schemas()[i])switch(g.system().schemas()[i][j]){case"property":case"link":case"collection":case"event":case"method":f.push(j)}}else f.push("main");f.sort(),f.forEach(function(a){e=e+'<option value="'+a+'">'+a+"</option>"}),c=this.require("dialog-modal-behavior-creation.html"),document.querySelector("#designer-dialog-behavior-creation").insertAdjacentHTML("afterbegin",c.source().replace(/{{title}}/gi,this.title()).replace(/{{states}}/gi,e)),d=document.getElementById("designer-dialog-behavior-creation-state"),d.addEventListener("keydown",function(a){if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),$("#designer-dialog-behavior-creation-state").val()&&this.ok(),!1}.bind(this)),d=document.getElementById("designer-dialog-behavior-creation-modal-cancel"),d.addEventListener("click",function(a){this.cancel()}.bind(this)),d=document.getElementById("designer-dialog-behavior-creation-modal-ok"),d.addEventListener("click",function(a){this.ok()}.bind(this)),$("#designer-dialog-behavior-creation-modal").on("shown.bs.modal",function(){$("#designer-dialog-behavior-creation-state")[0].focus()})}),q.on("show",function(){$("#designer-dialog-behavior-creation-modal").modal("show")}),q.on("hide",function(){$("#designer-dialog-behavior-creation-modal").modal("hide")});var r=this.require("DialogComponentCreation");r.on("init",function(a){var b="",c="",d=null,e="",f=this.require("designer"),g=f.system().models();$("#designer-dialog-component-creation").empty();for(c in g)e=e+'<option value="'+c+'">'+c+"</option>";b=this.require("dialog-modal-component-creation.html"),document.querySelector("#designer-dialog-component-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{models}}/gi,e)),d=document.getElementById("designer-dialog-component-creation-modal-cancel"),d.addEventListener("click",function(a){this.cancel()}.bind(this)),d=document.getElementById("designer-dialog-component-creation-modal-ok"),d.addEventListener("click",function(a){this.ok()}.bind(this))}),r.on("show",function(){$("#designer-dialog-component-creation-modal").modal("show")}),r.on("hide",function(){$("#designer-dialog-component-creation-modal").modal("hide")});var s=this.require("DialogRuntimeComponentInfo");s.on("init",function(a){var b="",c=null;$("#designer-dialog-runtimecomponent-info").empty(),b=this.require("dialog-modal-runtimecomponent-info.html"),document.querySelector("#designer-dialog-runtimecomponent-info").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-runtimecomponent-info-modal-ok"),c.addEventListener("click",function(a){this.hide()}.bind(this))}),s.on("show",function(){$("#designer-dialog-runtimecomponent-info-modal").modal("show")}),s.on("hide",function(){$("#designer-dialog-runtimecomponent-info-modal").modal("hide")});var t=this.require("ModelSystem");t.on("render",function(){var a=null,b=this,c="",d="",e="";a=this.require("model-system.html");for(d in this.document())["name","description","version"].indexOf(d)!==-1&&(e=this.document()[d],c=c+"<tr><td>"+d+"</td><td>"+e+"</td></tr>");document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{title}}/gi,this.title()).replace(/{{_id}}/gi,this.uuid()).replace(/{{content}}/gi,c)),a=document.getElementById("designer-system-"+this.uuid()).children[0].children[1],a&&a.addEventListener("click",function(a){this.require("designer").open("system.html#"+b.uuid()+"#description")}.bind(this)),a=document.getElementById("designer-system-"+this.uuid()+"-edit"),a&&a.addEventListener("click",function(a){this.require("designer").open("system.html#"+b.uuid()+"#description")}.bind(this)),a=document.getElementById("designer-system-"+this.uuid()+"-export"),a&&a.addEventListener("click",function(a){var b=(this.document().name,JSON.parse(JSON.stringify(this.document())));delete b.classInfo,this.require("designer").saveAs(b,this.document().name+".json")}.bind(this)),a=document.getElementById("designer-system-"+this.uuid()+"-delete"),a&&a.addEventListener("click",function(a){var b=this.require("storage").get("system-designer-systems"),c=this.require("designer"),d=this.require("System"),e=this.uuid();this.require("storage").remove(e),b.systems.splice(b.systems.indexOf(e),1),this.require("storage").set("system-designer-systems",b),c.system().destroy(),c.logs().forEach(function(a){this.logs().pop()}.bind(c)),b.systems.length&&c.system(new d(this.require("storage").get(b.systems[0]))),$("#designer-system-"+this.uuid()).remove(),this.destroy(),c.space(""),c.spaces().render(),c.workspace().refresh()}.bind(this))}),t.on("hide",function(){$("#designer-system-"+this.uuid()).hide()}),t.on("show",function(){$("#designer-system-"+this.uuid()).show()});var u=this.require("ModelType");u.on("render",function(){function a(a){var b="",c="";for(c in d.require("designer").system().models())if(d.require("designer").system().models()[c]._name===a){b=c;break}return b}function b(b,c){var e="";return e=Array.isArray(c)?c[0].indexOf("@")!==-1?"@RuntimeComponent"!==c[0]?'<div class="list-group-item" style="text-align: left">'+b+'<a href="#'+d.require("designer").system().id()+"#models#"+a(c[0].replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+c[0].replace("@","")+"</a> [ ]</div>":'<div class="list-group-item" style="text-align: left">'+b+c[0].replace("@","")+" [ ]</div>":["any","boolean","string","number","object","function","array","html","javascript","css"].indexOf(c[0])===-1?'<div class="list-group-item" style="text-align: left">'+b+'<a href="#'+d.require("designer").system().id()+"#types#"+c[0]+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+c[0].replace("@","")+"</a> [ ]</div>":'<div class="list-group-item" style="text-align: left">'+b+c[0]+" [ ]</div>":c.indexOf("@")!==-1?"@RuntimeComponent"!==c?'<div class="list-group-item" style="text-align: left">'+b+'<a href="#'+d.require("designer").system().id()+"#models#"+a(c.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+c.replace("@","")+"</a></div>":'<div class="list-group-item" style="text-align: left">'+b+c.replace("@","")+"</div>":["any","boolean","string","number","object","function","array","html","javascript","css"].indexOf(c)===-1?'<div class="list-group-item" style="text-align: left">'+b+'<a href="#'+d.require("designer").system().id()+"#types#"+c+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+c+"</a></div>":'<div class="list-group-item" style="text-align: left">'+b+c+"</div>"}var c=null,d=this,e="",f="",g="",h="";if(h=this.require("designer").system().id(),c=this.require("model-type.html"),this.document().schema)for(f in this.document().schema)this.document().schema.hasOwnProperty(f)&&(g=this.document().schema[f].type,e+=b(f+" : ",g));this.document().value&&this.document().value.forEach(function(a){e=e+'<div class="list-group-item" style="text-align: left">'+a+"</div>"}),this.document().schema||this.document().value||(g=this.document().type,e=e+'<div class="list-group-item" style="text-align: left"><i>alias</i> : '+g+"</div>"),""===e&&(e+='<a class="list-group-item" style="text-align: left"><br/><br/></a>'),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",c.source().replace(/{{title}}/gi,this.title()).replace(/{{id}}/gi,this.uuid()).replace(/{{content}}/gi,e)),c=document.getElementById("designer-type-"+this.uuid()).children[0].children[1],c&&c.addEventListener("click",function(a){this.require("designer").open("type.html#"+d.uuid()+"#"+h)}.bind(this)),c=document.getElementById("designer-type-"+this.uuid()+"-edit"),c&&c.addEventListener("click",function(a){this.require("designer").open("type.html#"+d.uuid()+"#"+h)}.bind(this)),c=document.getElementById("designer-type-"+this.uuid()+"-export"),c&&c.addEventListener("click",function(a){var b={name:"type "+this.document().name,master:!1,subsystem:!1,version:"0.0.1",description:"Type "+this.document().name,schemas:{},models:{},behaviors:{},types:{},components:{}};b.name=b.name.trim(),b.name=b.name.replace(/ /gi,"-"),b.name=b.name.toLocaleLowerCase(),b.types[this.document().name]=this.document(),this.require("designer").saveAs(b,this.document().name.replace(/ /gi,"-").toLowerCase()+".json")}.bind(this)),c=document.getElementById("designer-type-"+this.uuid()+"-delete"),c&&c.addEventListener("click",function(a){var b=this.require("designer");types=b.system().types(),delete types[this.title()],b.system().types(types),$("#designer-type-"+this.title()).remove(),this.require("channel").deleteType(this.uuid()),this.destroy(),b.save(),b.space(""),b.spaces().render(),b.workspace().refresh()}.bind(this))}),u.on("hide",function(){$("#designer-type-"+this.title()).hide()}),u.on("show",function(){$("#designer-type-"+this.title()).show()});var v=this.require("ModelSchema");v.on("render",function(){var a=null,b="",c=this,d="",e="",f="";f=this.uuid()||this.title(),systemId=this.require("designer").system().id(),a=this.require("model-schema.html");for(d in this.document())this.document().hasOwnProperty(d)&&0!==d.indexOf("_")&&(e=this.document()[d],b=b+"<tr><td>"+d+"</td><td>"+e+"</td></tr>");""===b&&(b+="<tr><td><br/><br/><br/></td><td><br/><br/><br/></td></tr>"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{title}}/gi,this.title()).replace(/{{id}}/gi,f).replace(/{{content}}/gi,b)),this.editable()?(a=document.getElementById("designer-schema-"+f).children[0].children[1],a&&a.addEventListener("click",function(a){this.require("designer").open("schema.html#"+c.uuid()+"#"+systemId)}.bind(this)),a=document.getElementById("designer-schema-"+f+"-edit"),a&&a.addEventListener("click",function(a){this.require("designer").open("schema.html#"+c.uuid()+"#"+systemId)}.bind(this)),a=document.getElementById("designer-schema-"+f+"-export"),a&&a.addEventListener("click",function(a){var b={name:"schema "+this.document()._name,master:!1,subsystem:!1,version:"0.0.1",description:"Schema "+this.document()._name,schemas:{},models:{},behaviors:{},types:{},components:{}};b.name=b.name.trim(),b.name=b.name.replace(/ /gi,"-"),b.name=b.name.toLocaleLowerCase(),b.schemas[this.document()._id]=this.document(),this.require("designer").saveAs(b,this.document()._name.replace(/ /gi,"-").toLowerCase()+".json")}.bind(this)),a=document.getElementById("designer-schema-"+f+"-delete"),a&&a.addEventListener("click",function(a){var b=this.require("designer");b.deleteSchema(this.uuid()),$("#designer-schema-"+this.uuid()).remove(),this.require("channel").deleteSchema(this.uuid()),this.destroy(),jsPlumb.deleteEveryEndpoint(),b.save(),b.space(""),b.spaces().render(),b.workspace().refresh()}.bind(this))):($("#designer-schema-"+f+" > div > div > div > button").hide(),a=document.getElementById("designer-schema-"+f).children[0].children[1],a&&a.addEventListener("click",function(a){var b=null;"RuntimeComponent"!==this.title()?this.require("designer").system().schemas()[c.uuid()]?this.require("designer").open("index.html#"+this.require("designer").system().id()+"#schemas#"+c.uuid(),"_self"):this.require("message").warning("Your schema ‘"+c.title()+"’ has not been yet created."):(b=this.require("DialogRuntimeComponentInfo"),b=new b({title:"RuntimeComponent schema"}),b.show())}.bind(this)))}),v.on("hide",function(){$("#designer-schema-"+this.uuid()).hide()}),v.on("show",function(){$("#designer-schema-"+this.uuid()).show()});var w=this.require("ModelClass");w.on("render",function(){function a(a){var b="",d="";for(d in c.require("designer").system().models())if(c.require("designer").system().models()[d]._name===a){b=d;break}return b}var b=null,c=this,d="",e="",f="",g="",h="",i="",j="",k=null,l="",m=null,n="";
l=this.uuid()||this.title(),n=this.require("designer").system().id(),k=function(b){o=b.type.indexOf("@")!==-1?o+b.name+' : <a href="#'+this.require("designer").system().id()+"#models#"+a(b.type.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+b.type.replace("@","")+"</a>, ":o+b.name+" : "+b.type+", "};for(d in this.document())if(this.document().hasOwnProperty(d))switch(i=this.document()[d],!0){case"undefined"!=typeof i.type:e=Array.isArray(i.type)?i.type[0].indexOf("@")!==-1?"123751cb591de26"!==l?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#models#"+a(i.type[0].replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type[0].replace("@","")+"</a> [ ]</div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type[0].replace("@","")+" [ ]</div>":["any","boolean","string","number","object","function","array","html","javascript","css"].indexOf(i.type[0])===-1?"123751cb591de26"!==l?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#types#"+i.type[0]+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type[0].replace("@","")+"</a> [ ]</div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type[0].replace("@","")+" [ ]</div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type[0]+" [ ]</div>":i.type.indexOf("@")!==-1?"123751cb591de26"!==l&&"@RuntimeComponent"!==i.type?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#models#"+a(i.type.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type.replace("@","")+"</a></div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type.replace("@","")+"</div>":["any","boolean","string","number","object","function","array","html","javascript","css"].indexOf(i.type)===-1&&"123751cb591de26"!==l?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#types#"+i.type+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type+"</a></div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type+"</div>";break;case"undefined"!=typeof i.params:j="undefined";var o="(";i.params.forEach(k.bind(this)),o+=")",o=o.replace(", )",")"),"undefined"!=typeof i.result?(j=i.result,"123751cb591de26"!==l?(j.indexOf("@")!==-1&&(j='<a href="#'+this.require("designer").system().id()+"#models#"+a(j.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+j.replace("@","")+"</a>"),g=g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>"+o+" : "+j+"</div>"):g=g+'<div class="list-group-item" style="text-align: left">+ '+d+o+" : "+j+"</div>"):"123751cb591de26"!==l?(j.indexOf("@")!==-1&&(j='<a href="#'+this.require("designer").system().id()+"#models#"+a(j.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+j.replace("@","")+"</a>"),g=g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>"+o+"</div>"):g=g+'<div class="list-group-item" style="text-align: left">+ '+d+o+"</div>";break;case d.indexOf("_")!==-1:break;default:j="undefined","undefined"!=typeof i.result?(j=i.result,"123751cb591de26"!==l?(j.indexOf("@")!==-1&&(j='<a href="#'+this.require("designer").system().id()+"#models#"+a(j.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+j.replace("@","")+"</a>"),g=g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>(): "+j+"</div>"):g=g+'<div class="list-group-item" style="text-align: left">+ '+d+"(): "+j+"</div>"):"123751cb591de26"!==l?(j.indexOf("@")!==-1&&(j='<a href="#'+this.require("designer").system().id()+"#models#"+a(j.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+j.replace("@","")+"</a>"),g=g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>()</div>"):g=g+'<div class="list-group-item" style="text-align: left">+ '+d+"()</div>"}""===e&&(e+='<a class="list-group-item" style="text-align: left"><br/></a>'),""===g&&(g+='<a class="list-group-item" style="text-align: left"><br/></a>'),m=this.require("model-class.html"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",m.source().replace(/{{title}}/gi,this.title()).replace(/{{_id}}/gi,l).replace(/{{attributes}}/gi,e).replace(/{{collections}}/gi,f).replace(/{{methods}}/gi,g).replace(/{{events}}/gi,h)),this.editable()?(b=document.getElementById("designer-model-"+l).children[0].children[1],b&&b.addEventListener("click",function(a){this.require("designer").open("model.html#"+c.uuid()+"#"+n)}.bind(this)),b=document.getElementById("designer-model-"+l+"-export"),b&&b.addEventListener("click",function(a){var b={name:"model "+this.document()._name,master:!1,subsystem:!1,version:"0.0.1",description:"Model "+this.document()._name,schemas:{},models:{},behaviors:{},types:{},components:{}};b.name=b.name.trim(),b.name=b.name.replace(/ /gi,"-"),b.name=b.name.toLocaleLowerCase(),b.models[this.document()._id]=this.document(),this.require("designer").saveAs(b,this.document()._name.replace(/ /gi,"-").toLowerCase()+".json")}.bind(this)),b=document.getElementById("designer-model-"+l+"-edit"),b&&b.addEventListener("click",function(a){this.require("designer").open("model.html#"+c.uuid()+"#"+n)}.bind(this))):($("#designer-model-"+l+" > div > div > div > button").hide(),b=document.getElementById("designer-model-"+l).children[0].children[1],b&&b.addEventListener("click",function(a){var b=null;"RuntimeComponent"!==this.title()?this.require("designer").system().models()[c.uuid()]?this.require("designer").open("index.html#"+this.require("designer").system().id()+"#models#"+c.uuid(),"_self"):this.require("message").warning("Your schema ‘"+c.title()+"’ has not been yet created."):(b=this.require("DialogRuntimeComponentInfo"),b=new b({title:"RuntimeComponent model"}),b.show())}.bind(this)))}),w.on("hide",function(){$("#designer-class-"+this.uuid()).hide()}),w.on("show",function(){$("#designer-class-"+this.uuid()).show()});var x=this.require("ModelBehavior");x.on("render",function(){var a="",b=null,c=this,d="";d=this.require("designer").system().id(),a=this.require("model-behavior.html"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{_id}}/gi,this.uuid()).replace(/{{title}}/gi,this.title()).replace(/{{content}}/gi,this.content())),b=document.getElementById("designer-behavior-"+this.uuid()).children[0].children[1],b&&b.addEventListener("click",function(a){this.require("designer").open("behavior.html#"+c.uuid()+"#"+d+"#action")}.bind(this)),b=document.getElementById("designer-behavior-"+this.uuid()+"-edit"),b&&b.addEventListener("click",function(a){this.require("designer").open("behavior.html#"+c.uuid()+"#"+d+"#action")}.bind(this)),b=document.getElementById("designer-behavior-"+this.uuid()+"-export"),b&&b.addEventListener("click",function(a){var b=this.document().state,c={name:"behavior "+b,master:!1,subsystem:!1,version:"0.0.1",description:"Behavior "+b,schemas:{},models:{},behaviors:{},types:{},components:{}};c.name=c.name.trim(),c.name=c.name.replace(/ /gi,"-"),c.name=c.name.toLocaleLowerCase(),c.behaviors[this.document()._id]=this.document(),this.require("designer").saveAs(c,b.replace(/ /gi,"-").toLowerCase()+".json")}.bind(this)),b=document.getElementById("designer-behavior-"+this.uuid()+"-delete"),b&&b.addEventListener("click",function(a){var b=this.require("designer");behaviors=b.system().behaviors(),delete behaviors[this.uuid()],b.system().behaviors(behaviors),$("#designer-behavior-"+this.uuid()).fadeOut(400,function(){$(this).remove()}),this.require("channel").deleteBehavior(this.uuid()),this.destroy(),b.save()}.bind(this))}),x.on("hide",function(){$("#designer-behavior-"+this.uuid()).hide()}),x.on("show",function(){$("#designer-behavior-"+this.uuid()).show()});var y=this.require("ModelComponent");y.on("render",function(){function a(a){var b="",c="";for(c in g.require("designer").system().schemas())if(g.require("designer").system().schemas()[c]._name===a){b=g.require("designer").system().schemas()[c];break}return b}function b(a){var b="",c="";for(c in g.require("designer").system().models())if(g.require("designer").system().models()[c]._name===a){b=g.require("designer").system().models()[c];break}return b}function c(a){l=l+'<a href="#'+runtime.require("designer").system().id()+"#components#"+model[h].type[0].replace("@","")+"#"+a+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+JSON.stringify(a)+"</a>,<br>"}var d=null,e=null,f="",g=this,h="",i="",j="",k="",l="",m=null;k=this.require("designer").system().id(),m=a(this.model()),model=b(this.model());for(h in this.document())if(this.document().hasOwnProperty(h)&&"_id"!==h)switch(i=this.document()[h],j=JSON.stringify(i),!0){case"link"===m[h]&&"string"==typeof i:f=f+"<tr><td>"+h+'</td><td><a href="#'+this.require("designer").system().id()+"#components#"+model[h].type.replace("@","")+"#"+i+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+JSON.stringify(i)+"</a></td></tr>";break;case"collection"===m[h]&&Array.isArray(i)&&model[h].type[0].indexOf("@")!==-1:i.forEach(c),f=f+"<tr><td>"+h+"</td><td>["+l+"]</td></tr>",f=f.replace(",<br>]","]");break;default:f=j.length<25?f+"<tr><td>"+h+"</td><td>"+JSON.stringify(i)+"</td></tr>":f+"<tr><td>"+h+"</td><td>"+JSON.stringify(i).substring(0,25)+' ..."</td></tr>'}""===f&&(f+="<tr><td><br/><br/></td><td><br/><br/></td></tr>"),d=this.require("model-component.html"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",d.source().replace(/{{title}}/gi,this.title()).replace(/{{_id}}/gi,this.uuid().replace(/\./g,"-")).replace(/{{content}}/gi,f)),e=document.getElementById("designer-component-"+this.uuid().replace(/\./g,"-")).children[0].children[1],e&&e.addEventListener("click",function(a){this.require("designer").open("component.html#"+encodeURIComponent(g.title())+"#"+encodeURIComponent(g.model())+"#"+k)}.bind(this)),e=document.getElementById("designer-component-"+this.uuid().replace(/\./g,"-")+"-edit"),e&&e.addEventListener("click",function(a){this.require("designer").open("component.html#"+encodeURIComponent(g.title())+"#"+encodeURIComponent(g.model())+"#"+k)}.bind(this)),e=document.getElementById("designer-component-"+this.uuid().replace(/\./g,"-")+"-export"),e&&e.addEventListener("click",function(a){var b=this.document()._id,c={name:"component "+b,master:!1,subsystem:!1,version:"0.0.1",description:"Component "+b,schemas:{},models:{},behaviors:{},types:{},components:{}};c.name=c.name.trim(),c.name=c.name.replace(/ /gi,"-"),c.name=c.name.toLocaleLowerCase(),c.components[this.model()]={},c.components[this.model()][this.document()._id]=this.document(),this.require("designer").saveAs(c,b.replace(/ /gi,"-").toLowerCase()+".json")}.bind(this)),e=document.getElementById("designer-component-"+this.uuid().replace(/\./g,"-")+"-delete"),e&&e.addEventListener("click",function(a){var b=this.require("designer"),c=b.system().components();delete c[this.model()][this.uuid()],b.system().components(c),$("#designer-component-"+this.uuid().replace(/\./g,"-")).fadeOut(400,function(){$(this).remove()}),this.require("channel").deleteComponent(this.uuid(),this.model()),this.destroy(),b.save()}.bind(this))}),y.on("hide",function(){$("#designer-component-"+this.uuid()).hide()}),y.on("show",function(){$("#designer-component-"+this.uuid()).show()});var z=this.require("ModelLog");z.on("render",function(){var a=null,b="";htmlComp=this.require("model-log.html"),this.require("designer").logs().forEach(function(a){switch(a.type()){case"debug":b=b+'<p class="text-muted">'+a.log()+"</p>";break;case"info":b=b+'<p class="text-info">'+a.log()+"</p>";break;case"warn":b=b+'<p class="text-warning">'+a.log()+"</p>";break;case"error":b=b+'<p class="text-danger">'+a.log()+"</p>"}}),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",htmlComp.source().replace("{{logs}}",b)),a=document.getElementById("designer-log-clean"),a.addEventListener("click",function(a){this.require("designer").logs().forEach(function(a){this.logs().pop()}.bind(this.require("designer"))),document.querySelector("#designer-loug-output").innerHTML=""}.bind(this))}),z.on("hide",function(){$("#designer-log").hide()}),z.on("show",function(){$("#designer-log").show()});var A=this.require("MenuBar");A.on("init",function(a){var b=[],c=[],d=[],e=this;b=this.require("db").collections().MenuHeader.find({type:"designer"}),this.header(this.require(b[0]._id)),c=this.require("db").collections().MenuItem.find({type:"designer"}),c.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),c.forEach(function(a){var b=a._id;e.items().push(e.require(b))}),d=this.require("db").collections().MenuAction.find({type:"designer"}),d.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),d.forEach(function(a){var b=a._id;e.actions().push(e.require(b))})}),A.on("render",function(){function a(){var a=0,b=0,c=null;for(a=f.children.length,b=0;b<a;b++)c=f.children[b],$(c).removeClass("active")}var b=0,c=0,d=null,e=document.getElementById("designer-menubar-header"),f=document.getElementById("designer-menubar-items"),g=document.getElementById("designer-menubar-actions"),h=this,i=window.location.href.split("#"),j=window.location.href.split("?messages="),k=[],l="system",m="",n=this.require("designer");e.insertAdjacentHTML("afterbegin",this.header().html().source()),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend","<li>"+a.html().source()+"</>")});var o=function(){a(),$(this).addClass("active")};for(b=f.children.length,c=0;c<b;c++)d=f.children[c],d.addEventListener("click",o),d.addEventListener("click",function(){this.click()}.bind(h.items(c)));for(this.actions().forEach(function(a){g.insertAdjacentHTML("afterbegin","<li>"+a.html().source()+"</>")}),i.length>2&&0!==i[2].length&&(l=i[2],l=l.split("?")[0]),i.length>3&&(m=i[3],m=m.split("?")[0]),i.length>4&&n.state().component(i[4].split("?")[0]),c=0;c<b;c++)this.items(c).name()===l&&(d=f.children[c],$(d).addClass("active"));m&&n.space(m),n.context(l);var p=this;$("#designer-menu-action-search").on("keyup",function(a){var b=$("#designer-menu-action-search").val();p.designer().filter(b)}),n.updateRouter(),j[1]&&(k=JSON.parse(decodeURIComponent(j[1])),n.messages(k))});var B=this.require("ToolBar");B.on("init",function(a){var b=[],c=this;b=this.require("db").collections().ToolBarItem.find({type:"designer"}),b.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),b.forEach(function(a){var b=a._id;c.items().push(c.require(b))})}),B.on("render",function(){var a=document.getElementById("designer-toolbar-items"),b=0,c=0,d=null,e=this;for(this.items().forEach(function(b){a.insertAdjacentHTML("beforeend","<li>"+b.html().source()+"</>")}),c=a.children.length,b=0;b<c;b++)d=a.children[b],d.addEventListener("click",function(){this.click()}.bind(e.items(b)))});var C=this.require("Spaces");C.on("init",function(a){}),C.on("clear",function(){this.require("designer").space(""),$("#designer-spaces-items").empty()}),C.on("render",function(){function a(){var a=0,b=0,c=null;for(a=f.children.length,b=0;b<a;b++)c=f.children[b],$(c).removeClass("active")}var b=null,c=this.designer().system(),d=this.require("SpaceItem"),e=null,f=document.getElementById("designer-spaces-items"),g=this,h="",i=null;switch($("#designer-spaces-help").empty(),this.designer().context()){case"system":document.getElementById("designer-spaces-type").innerHTML="Systems",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-system.html").source());break;case"schemas":document.getElementById("designer-spaces-type").innerHTML="Schemas",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-schemas.html").source());break;case"models":document.getElementById("designer-spaces-type").innerHTML="Models",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-models.html").source());break;case"types":document.getElementById("designer-spaces-type").innerHTML="Types",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-types.html").source());break;case"behaviors":document.getElementById("designer-spaces-type").innerHTML="Behaviors",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-behaviors.html").source());break;case"components":document.getElementById("designer-spaces-type").innerHTML="Components",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-components.html").source());break;case"logs":document.getElementById("designer-spaces-type").innerHTML="Logs",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-logs.html").source())}if($("#designer-spaces-items").empty(),c)switch(this.designer().context()){case"system":this.items().forEach(function(a){this.items().pop()}.bind(this));var j=this.require("storage").get("system-designer-systems"),k=[],l=0,m=0;for(j&&(k=j.systems),l=k.length,m=0;m<l;m++)c=this.require("storage").get(k[m]),e=new d({name:c.name,uuid:c._id}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+a.uuid()+"#system#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;m<l;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));this.items().forEach(function(a){a.on("click",function(){var a=this.require("designer"),b=this.require("storage").get(this.uuid()),c=this.require("System");b&&a.system(new c(b)),a.logs().forEach(function(a){this.logs().pop()}.bind(a))})}),l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):this.require("designer").system()?$("#designer-space-"+this.require("designer").system().name()).length&&($("#designer-space-"+this.require("designer").system().name()).addClass("active"),this.require("designer").space(this.require("designer").system().name())):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())));break;case"schemas":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.schemas())e=new d({name:c.schemas()[h]._name,uuid:h}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.uuid()+'" class=""><a href="#'+c.id()+"#schemas#"+a.uuid()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;m<l;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0?$("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).uuid())):this.require("designer").space("");break;case"models":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.models())e=new d({name:c.models()[h]._name,uuid:h}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.uuid()+'" class=""><a href="#'+c.id()+"#models#"+a.uuid()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;m<l;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0?$("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).uuid())):this.require("designer").space("");break;case"types":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.types())e=new d({name:h}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+c.id()+"#types#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;m<l;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())));break;case"behaviors":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.models())e=new d({name:c.models()[h]._name,uuid:h}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()<d.name()&&(e=1),c.name()>d.name()&&(e=-1),e}),this.require("storage").get("system-designer-systems")&&this.require("storage").get("system-designer-systems").systems.length&&(e=new d({name:this.require("designer").system().name(),uuid:this.require("designer").system().id()}),this.items().push(e)),this.items().reverse(),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+c.id()+"#behaviors#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;m<l;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())));break;case"components":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.models())e=new d({name:c.models()[h]._name,uuid:h}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+c.id()+"#components#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;m<l;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())));break;case"logs":f.insertAdjacentHTML("beforeend",'<li class="active"><a href="#'+c.id()+'#logs">Console output</a></li>')}});var D=this.require("Workspace");D.on("init",function(a){var b=this;$("html").on("dragenter dragover",!1).on("drop",function(a){a.stopPropagation(),a.preventDefault();var c=a.originalEvent.dataTransfer.files,d=new FileReader,e="";d.onload=function(a){e+=a.target.result},d.onloadend=function(){var a=JSON.parse(e),c=b.require("DialogDropFile");c=new c({title:"A system has been found",message:"What do you want to do ?"}),c.data(a),c.show()},d.readAsText(c[0],"UTF-8")})}),D.on("create",function(){function a(a){var b="",c="";for(c in h.system().models())if(h.system().models()[c]._name===a){b=c;break}return b}function b(a){var b="",c="";for(c in h.system().schemas())if(h.system().schemas()[c]._name===a){b=h.system().schemas()[c];break}return b}function c(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var d="",e=null,f=null,g=this.require("designer").system();switch(this.designer().context()){case"system":e=this.require("DialogSystemCreation"),f=new e({title:"Create a new system"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}function b(a){var b=runtime.require("storage").get("system-designer-systems"),c=[],d=/[\&\(\)\[\]\'\"\*\,\;\:\%]/i,e=0,f=!0;for(b&&(c=b.systems),length=c.length,e=0;e<length;e++)if(g=runtime.require("storage").get(c[e]),g.name===a){f=!1;break}return f=f&&null===a.match(d)}var c=this.require("designer"),d=null,e="",f="",g={},h=this.require("System"),i=null,j=null;d=$("#designer-dialog-system-creation-name").val(),d=d.trim(),d=d.replace(/ /gi,"-"),d&&b(d)&&(e=a(),f=a(),g={name:d,master:!0,subsystem:!1,version:"0.0.1",description:"",schemas:{},models:{},behaviors:{},types:{},components:{},_id:e},g.behaviors[f]={_id:f,component:e,state:"main",action:"function main() { \n\t\n}",useCoreAPI:!1,core:!1},c.system()&&c.system().destroy(),c.system(new h(g)),i=this.require("ModelSystem"),j=new i({title:d}),j.uuid=e,j.document(JSON.parse(JSON.stringify(g))),j.content(JSON.stringify(g)),c.save(),this.hide(),c.space(d),c.spaces().render(),c.workspace().refresh(),this.require("message").success("system created. You can now begin to create schemas."))});break;case"schemas":g&&Object.keys(g).length&&(e=this.require("DialogSchemaCreation"),f=new e({title:"Create a new schema"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}function b(a){var b=!0,c="";for(c in runtime.require("designer").system().schemas())if(runtime.require("designer").system().schemas()[c]._name===a){b=!1;break}return b}var c=this.require("designer"),e=null,f={},g={},h=null,i=null;e=$("#designer-dialog-schema-creation-name").val(),e=e.trim(),e=e.replace(/ /gi,"_"),e&&b(e)&&(d=a().toString(),f={_id:d,_name:e,_inherit:["RuntimeComponent"]},g=c.system().schemas(),g[d]=f,c.system().schemas(g),h=this.require("ModelSchema"),i=new h({title:e}),i.document(JSON.parse(JSON.stringify(f))),i.content(JSON.stringify(f)),i.uuid(d),c.save(),c.createModel(f),this.require("channel").createSchema(e,f),this.hide(),c.space(d),c.spaces().render(),c.workspace().refresh(),this.require("message").success("schema created. A model has been also generated."))}));break;case"models":g&&Object.keys(g).length&&(e=this.require("DialogModelCreation"),f=new e({title:"Create a new model"}),f.show(),f.on("ok",function(){this.hide()}));break;case"types":g&&Object.keys(g).length&&(e=this.require("DialogTypeCreation"),f=new e({title:"Create a new type"}),f.show(),f.on("ok",function(){var a=this.require("designer"),b=null,c=!1,d={},e=a.system().types(),f=null,g=null;b=$("#designer-dialog-type-creation-name").val(),c=$("#designer-dialog-type-creation-isEnum")[0].checked,b=b.trim(),b=b.replace(/ /gi,"_"),b&&(d=c?{name:b,type:"string",value:["value1","value2"]}:{name:b,type:"object",schema:{property1:{type:"string",mandatory:!0},property2:{type:"string",mandatory:!0}}},e[b]=d,a.system().types(e),f=this.require("ModelType"),g=new f({title:b}),g.uuid=b,g.document(JSON.parse(JSON.stringify(d))),g.content(JSON.stringify(d)),a.save(),this.require("channel").createType(b,d),this.hide(),a.space(b),a.spaces().render(),a.workspace().refresh(),this.require("message").success("type created. You can use it in your model."))}));break;case"components":if(g&&Object.keys(g).length){var h=this.require("designer"),i=(h.system().schemas(),h.system().models()),j=h.system().components(),k={},l=null,m=null,n="",o="",p="",q=null;if(n=a(h.space()),o=h.space(),q=b(o),Object.keys(q).length){p=c(),k={_id:p};var r=[];for(var s in q)"property"===q[s]&&r.push(s),"link"===q[s]&&r.push(s),"collection"===q[s]&&r.push(s);r.sort(),length=r.length;for(var t=0;t<length;t++)k[r[t]]=i[n][r[t]].default;j[o]||(j[o]={}),j[o][p]=k,h.system().components(j),l=this.require("ModelComponent"),m=new l({title:p}),m.model(o),m.uuid(p.toString()),m.document(JSON.parse(JSON.stringify(k))),m.content(JSON.stringify(k)),m.render(),$("#designer-component-"+p.toString()).hide(),$("#designer-component-"+p.toString()).fadeIn(1e3),h.save(),this.require("channel").createComponent(o,k)}else this.require("message").warning("there is no schema. Create a schema before creating a component.")}break;case"behaviors":g&&Object.keys(g).length&&(e=this.require("DialogBehaviorCreation"),f=new e({title:"Create a new behavior"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}function b(a){var b="",c="";for(c in f.system().schemas())if(f.system().schemas()[c]._name===a){b=c;break}return b}function c(a){var b="",c="";for(c in f.system().models())if(f.system().models()[c]._name===a){b=c;break}return b}function e(a,b){var c=!1;for(d in f.system().behaviors())if(f.system().behaviors()[d].state===a&&f.system().behaviors()[d].component===b){c=!0;break}return c}var f=this.require("designer"),g=f.system().schemas(),h=f.system().models(),i=f.system().behaviors(),j=this.require("message"),k="",l="",m=null,n={},o="",p="\t\n",q=null,r=null,s="",t="",u="",v="",w=!0,x=0,y=0;if(s=f.space(),t=$("#designer-dialog-behavior-creation-state").val(),s&&t){if(u=a(),s!==f.system().name()){if(k=b(s),l=c(s),h[l][t]&&(m=h[l][t].params),m&&m.length)for(y=m.length,x=0;x<y;x++)v=0===x?m[x].name:v+", "+m[x].name;if("property"!==g[k][t]&&"link"!==g[k][t]||(v="value"),"collection"===g[k][t]&&(v="size, value, event"),"method"===g[k][t]&&e(t,s)&&(w=!1),"init"===t&&(v="conf",e(t,s)&&(w=!1)),"destroy"===t&&e(t,s)&&(w=!1),h[l][t]&&(o=h[l][t].result),o)switch(o){case"string":p="\tvar result = '';\n\treturn result;\n";break;case"array":p="\tvar result = [];\n\treturn result;\n";break;case"number":p="\tvar result = 0;\n\treturn result;\n";break;case"object":p="\tvar result = {};\n\treturn result;\n";break;default:p="\tvar result = {};\n\treturn result;\n"}}else s=f.system().id(),e(t,s)&&(w=!1);w?(n={_id:u,component:s,state:t,action:"function "+t+"("+v+") { \n"+p+"}",useCoreAPI:!1,core:!1},i[u]=n,f.system().behaviors(i),q=this.require("ModelBehavior"),r=new q({uuid:u}),r.title(t),r.document(n),r.content(JSON.parse(JSON.stringify(n.action))),this.hide(),r.render(),Prism.highlightAll(),$("#designer-behavior-"+u.toString()).hide(),$("#designer-behavior-"+u.toString()).fadeIn(1e3),f.save(),this.require("channel").createBehavior(n)):(this.hide(),j.warning("Can not create two behaviors for a method."))}}))}}),D.on("refresh",function(){
function a(a){var b="",c="";for(c in s.schemas())if(s.schemas()[c]._name===a){b=c;break}return b}function b(a){var b="",c="";for(c in s.models())if(s.models()[c]._name===a){b=c;break}return b}var c=null,d=null,e=null,f=null,g=null,h=null,i="",j="",k="",l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=this.designer().system(),t=this.designer().space(),u="",v=[],w=null,x=null,y=[],z=0;if(length=0,s){switch(this.clear(),this.designer().context()){case"system":for(x=this.require("storage").get("system-designer-systems"),x&&(y=x.systems),length=y.length,z=0;z<length;z++)s=this.require("storage").get(y[z]),s.name===t&&(c=this.require("ModelSystem"),h=new c({title:s.name}),h.uuid(s._id),h.document(JSON.parse(JSON.stringify(s))),h.content(JSON.stringify(s)),h.render());""===t&&length>0&&this.require("message").warning("system not found.");break;case"schemas":if(t)for(j in s.schemas())if(s.schemas()[j]._id===t){for(d=this.require("ModelSchema"),v=[],s.schemas()[j]._inherit&&(w=s.schemas()[j]._inherit.slice(),w.reverse()),length=0,w&&(length=w.length),z=0;z<length;z++){if(u=a(w[z]),f=new d({title:w[z]}),"RuntimeComponent"===w[z]){u="111df11e2b19fde";var A={_id:"RuntimeComponent",_name:"RuntimeComponent",_core:!0,classInfo:"property",on:"method",off:"method",require:"method",destroy:"method",init:"method",error:"event"};f.document(A),f.content(JSON.stringify(A)),v.push(u),f.uuid(u)}else s.schemas()[a(w[z])]?(f.document(JSON.parse(JSON.stringify(s.schemas()[a(w[z])]))),f.content(JSON.stringify(s.schemas()[a(w[z])])),v.push(a(w[z])),f.uuid(a(w[z]))):(v.push(w[z]),f.uuid(w[z]));f.render()}for(f=new d({title:s.schemas()[j]._name}),f.uuid(j),f.document(JSON.parse(JSON.stringify(s.schemas()[j]))),f.content(JSON.stringify(s.schemas()[j])),f.editable(!0),f.render(),length=v.length,z=0;z<length;z++)this.designer().linkModel(j,v[z])}break;case"models":if(t)for(j in s.models())if(s.models()[j]._id===t){for(e=this.require("ModelClass"),k=a(s.models()[j]._name),v=[],k&&s.schemas()[k]._inherit&&(w=s.schemas()[k]._inherit.slice(),w.reverse()),length=0,w&&(length=w.length),z=0;z<length;z++){if(u=a(w[z]),l=new e({title:w[z]}),"RuntimeComponent"===w[z]){u="123751cb591de26";var B={_name:"RuntimeComponent",_core:!0,on:{params:[{name:"state",type:"string"},{name:"handler",type:"function"},{name:"useCoreAPI",type:"boolean",mandatory:!1},{name:"isCore",type:"boolean",mandatory:!1}],result:"string"},off:{params:[{name:"state",type:"string"},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}],result:"RuntimeComponent"},destroy:{params:[]},classInfo:{type:"@RuntimeClassInfo",readOnly:!1,mandatory:!1,default:{}},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]}};l.document(B),l.content(JSON.stringify(B)),v.push(u),l.uuid(u)}else s.models()[b(w[z])]?(l.document(JSON.parse(JSON.stringify(s.models()[b(w[z])]))),l.content(JSON.stringify(s.models()[b(w[z])])),v.push(b(w[z])),l.uuid(b(w[z]))):(v.push(w[z]),l.uuid(u));l.render()}for(l=new e({title:s.models()[j]._name}),l.uuid(j),l.document(JSON.parse(JSON.stringify(s.models()[j]))),l.content(JSON.stringify(s.models()[j])),l.editable(!0),l.render(),length=v.length,z=0;z<length;z++)this.designer().linkModel(j,v[z])}break;case"types":if(t)for(i in s.types())s.types()[i].name===t&&(m=this.require("ModelType"),n=new m({title:i}),n.uuid(i),n.document(JSON.parse(JSON.stringify(s.types()[t]))),n.content(JSON.stringify(s.types()[t])),n.render());break;case"components":if(t)if(this.require("designer").state().component())i=this.require("designer").state().component(),s.components()[t][i]&&(o=this.require("ModelComponent"),p=new o({title:i}),p.uuid(i),p.model(t),p.document(JSON.parse(JSON.stringify(s.components()[t][i]))),p.content(JSON.stringify(s.components()[t][i])),p.render());else for(i in s.components()[t])o=this.require("ModelComponent"),p=new o({title:i}),p.uuid(i),p.model(t),p.document(JSON.parse(JSON.stringify(s.components()[t][i]))),p.content(JSON.stringify(s.components()[t][i])),p.render();break;case"behaviors":if(t){i=this.require("designer").state().component();for(j in s.behaviors())s.behaviors()[j].component===t&&(i&&s.behaviors()[j].state===i||""===i)&&(q=this.require("ModelBehavior"),r=new q({uuid:s.behaviors()[j]._id}),r.title(s.behaviors()[j].state),r.document(s.behaviors()[j]),r.content(JSON.parse(JSON.stringify(s.behaviors()[j].action))),r.render()),t===this.require("designer").system().name()&&s.behaviors()[j].component===this.require("designer").system().id()&&(q=this.require("ModelBehavior"),r=new q({uuid:s.behaviors()[j]._id}),r.title(s.behaviors()[j].state),r.document(s.behaviors()[j]),r.content(JSON.parse(JSON.stringify(s.behaviors()[j].action))),r.render());Prism.highlightAll()}break;case"logs":g=this.require("ModelLog"),modelLog=new g,modelLog.render()}this.designer().filter()&&this.designer().filter(this.designer().filter())}else x=this.require("storage").get("system-designer-systems"),x&&x.systems&&x.systems.length&&this.require("message").warning("system not found.")}),D.on("clear",function(){$("#designer-workspace").empty(),jsPlumb.ready(function(){jsPlumb.deleteEveryEndpoint()})});var E=this.require("Server");E.on("start",function(){var a=null,b=null;a=this.require("RuntimeChannel"),b=new a({_id:"channel"}),b.on("send",function(a){var b=this.require("storage").get("system-designer-config");this.require("storage").set("system-designer-message",a),this.require("designer").debugWindow()&&this.require("designer").debugWindow().postMessage(JSON.stringify(a),"*"),"undefined"!=typeof b.debugType&&"server"===b.debugType&&b.urlServer&&$.post(b.urlServer+":8888/"+a.event,encodeURIComponent(JSON.stringify(a.data)))}),b.on("logDebug",function(a){var b="",c=null;c=this.require("Log"),b=new c({type:"debug",log:a.replace("runtime:","")}),this.require("designer").logs().push(b),this.require("message").info(a.replace(/\[[^\]]+\]/,"<strong>runtime:</strong> "))}),b.on("logInfo",function(a){var b="",c=null;c=this.require("Log"),b=new c({type:"info",log:a.replace("runtime:","")}),this.require("designer").logs().push(b),this.require("message").info(a.replace(/\[[^\]]+\]/,"<strong>runtime:</strong> "))}),b.on("logWarn",function(a){var b="",c=null;c=this.require("Log"),b=new c({type:"warn",log:a.replace("runtime:","")}),this.require("designer").logs().push(b),this.require("message").warning(a.replace(/\[[^\]]+\]/,"<strong>runtime:</strong> "))}),b.on("logError",function(a){var b="",c=null;c=this.require("Log"),b=new c({type:"error",log:a.replace("runtime:","")}),this.require("designer").logs().push(b),this.require("message").danger(a.replace(/\[[^\]]+\]/,"<strong>runtime:</strong> "))}),b.on("getSystem",function(a){var b=null;a===this.require("designer").system().id()?(b=this.require("db").collections().System.find({_id:a})[0],b=JSON.parse(JSON.stringify(b)),delete b.classInfo,this.setSystem(a,b)):this.setSystem(a,this.require("storage").get(a))}),b.on("getInitSystem",function(a){var b=null;a===this.require("designer").system().id()?(b=this.require("db").collections().System.find({_id:a})[0],b=JSON.parse(JSON.stringify(b)),delete b.classInfo,this.setInitSystem(a,b)):this.setInitSystem(a,this.require("storage").get(a))}),b.on("getType",function(a){this.setType(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].types[a])}),b.on("getSchema",function(a){this.setSchema(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].schemas[a])}),b.on("getModel",function(a){this.setModel(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].models[a])}),b.on("getBehavior",function(a){this.setBehavior(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].behaviors[a])}),b.on("getComponent",function(a,b){function c(a){var b="",c="";for(c in e.system().models())if(e.system().models()[c]._name===a){b=c;break}return b}var d="",e=this.require("designer");d=c(b),this.setComponent(a,b,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].components[b][a],this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].models[d])}),b.on("updateType",function(a,b){var c=this.require("designer"),d=c.system().types();d[a]=b,c.system().types(d),c.save(),c.space(b.name),c.spaces().render(),c.workspace().refresh()}),b.on("deleteType",function(a){var b=this.require("designer"),c=b.system().types(),d=[],e=null;d=this.require("db").collections().ModelType.find({uuid:a}),d.length&&(e=this.require(d[0]._id),e&&(e.hide(),e.destroy())),delete c[a],b.system().types(c),b.save(),b.workspace().refresh()}),b.on("updateSchemaName",function(a,b){function c(a,b){var c="",d="";for(d in b)if(b[d]._name===a){c=d;break}return c}var d=this.require("designer"),e=d.system().schemas()[b]._name,f=d.system().models(),g=d.system().behaviors(),h=d.system().components(),i="",j="";i=c(e,d.system().models()),f[i]._name=a,d.system().models(f);for(j in g)g[j].component===e&&(g[j].component=a,d.system().behaviors(g));h[e]&&(h[a]=JSON.parse(JSON.stringify(h[e])),delete h[e],d.system().components(h)),d.save()}),b.on("updateSchema",function(a,b){var c=this.require("designer"),d=c.system().schemas();jsPlumb.deleteEveryEndpoint(),c.syncModel(b),d[a]=b,c.system().schemas(d),c.save(),c.space(a),c.spaces().render(),c.workspace().refresh()}),b.on("deleteSchema",function(a){var b=this.require("designer"),c=b.system().schemas(),d=[],e=null;d=this.require("db").collections().ModelSchema.find({uuid:a}),d.length&&(e=this.require(d[0]._id),e&&(e.hide(),e.destroy())),delete c[a],b.system().schemas(c),b.save(),b.workspace().refresh()}),b.on("updateSchemaId",function(a,b){var c=this.require("designer"),d=c.system().schemas(),e=null;e=JSON.parse(JSON.stringify(d[a])),delete d[a],e._id=b,d[b]=e,c.system().schemas(d),c.save(),c.workspace().refresh()}),b.on("updateModel",function(a,b){var c=this.require("designer"),d=c.system().models();jsPlumb.deleteEveryEndpoint(),d[a]=b,c.system().models(d),c.save(),c.syncBehavior(b),c.space(a),c.spaces().render(),c.workspace().refresh()}),b.on("deleteModel",function(a){var b=this.require("designer"),c=b.system().models(),d=[],e=null;d=this.require("db").collections().ModelClass.find({uuid:a}),d.length&&(e=this.require(d[0]._id),e&&(e.hide(),e.destroy())),delete c[a],b.system().models(c),b.save(),b.workspace().refresh()}),b.on("updateModelId",function(a,b){var c=this.require("designer"),d=c.system().models(),e=null;e=JSON.parse(JSON.stringify(d[a])),delete d[a],e._id=b,d[b]=e,c.system().models(d),c.save(),c.workspace().refresh()}),b.on("updateBehavior",function(a,b){var c=this.require("designer"),d=c.system().behaviors();d[a]=b,c.system().behaviors(d),c.save(),c.workspace().refresh()}),b.on("deleteBehavior",function(a){var b=this.require("designer"),c=b.system().behaviors(),d=[],e=null;d=this.require("db").collections().ModelBehavior.find({uuid:a}),d.length&&(e=this.require(d[0]._id),e&&(e.hide(),e.destroy())),delete c[a],b.system().behaviors(c),b.save(),b.workspace().refresh()}),b.on("updateComponent",function(a,b,c){var d=this.require("designer"),e=d.system().components();e[b][a]=c,d.system().components(e),d.save(),d.workspace().refresh()}),b.on("deleteComponent",function(a,b){var c=this.require("designer"),d=c.system().components(),e=[],f=null;e=this.require("db").collections().ModelComponent.find({uuid:a}),e.length&&(f=this.require(e[0]._id),f&&(f.hide(),f.destroy())),delete d[b][a],c.system().components(d),c.save(),c.workspace().refresh()}),b.on("updateSystem",function(a,b){var c=this.require("System"),d=null,e=this.require("designer");e.system()&&e.system().destroy(),d=new c(b),e.system(d),e.save(),e.space(b.name),e.spaces().render(),e.workspace().refresh()}),b.on("loadSystem",function(a){var b=null,c=null;"app-designer-testing"!==a.name&&(b=this.require("DialogImport"),c=new b({title:"A system has been found",message:"Do you want to import the system ?",data:a}),c.show(),c.on("ok",function(){var a=this.require("System"),b=null,c=this.require("designer"),d=this.require("message");c.system()&&c.system().destroy(),b=new a(this.data()),c.system(b),c.logs().forEach(function(a){this.logs().pop()}.bind(c)),c.save(),c.space(b.name()),c.spaces().render(),c.workspace().refresh(),this.hide(),c.save(),d.success("importation of the system is done.")}))}),window.addEventListener("message",function(a){var b=null,c=this.require("storage").get("system-designer-config");c||(c={}),b=JSON.parse(a.data),b&&"undefined"!=typeof b.event&&"undefined"!=typeof b.from&&"undefined"!=typeof b.data&&$db.RuntimeMessage.insert(b)}.bind(b),!1),this.require("storage").on("changed",function(a){"undefined"!=typeof a["system-designer-message"]&&(this.require("designer").debugWindow()&&this.require("designer").debugWindow().postMessage(JSON.stringify(a["system-designer-message"].newValue),"*"),$db.RuntimeMessage.insert(a["system-designer-message"].newValue))},!0)},!0);var F=this.require("Designer");F.on("check",function(){var a=null,b=null;"undefined"==typeof SharedWorker&&(a=this.require("DialogCheck"),b=new a({title:"Hem... You will laugh",message:"Your browser has not all the features to use correctly System Designer.<br><br>Please use:<br><br>- Mozilla Firefox (recommended) or <br>- Google Chrome (desktop only).<br><br>"}),b.show())}),F.on("logs",function(a,b,c){var d=null,e="";if("add"===c&&"logs"===this.context()){switch(d=this.require(b),d.type()){case"debug":e=e+'<p class="text-muted">'+d.log()+"</p>";break;case"info":e=e+'<p class="text-info">'+d.log()+"</p>";break;case"warn":e=e+'<p class="text-warning">'+d.log()+"</p>";break;case"error":e=e+'<p class="text-danger">'+d.log()+"</p>"}document.querySelector("#designer-loug-output").insertAdjacentHTML("afterbegin",e)}}),F.on("welcome",function(){var a=null,b=null,c=null;c=this.require("storage").get("system-designer-config"),c||(c={}),"undefined"==typeof c.welcomeScreen&&(a=this.require("DialogWelcome"),b=new a({title:"Welcome to System Designer"}),b.show(),b.on("ok",function(){var a=this.require("storage").get("system-designer-config");a||(a={}),a.welcomeScreen=!1,this.require("storage").set("system-designer-config",a),this.hide()}))}),F.on("render",function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l="",m=null,n=null;a=this.require("MenuBar"),b=new a({designer:this}),c=this.require("ToolBar"),d=new c({designer:this}),e=this.require("Workspace"),f=new e({designer:this}),i=this.require("Spaces"),j=new i({designer:this}),m=this.require("Server"),n=new m({designer:this}),this.menubar(b),this.toolbar(d),this.workspace(f),this.spaces(j),this.server(n),this.require("logger").on("warn",function(a){this.require("message").warning(a)}),this.require("logger").on("error",function(a){this.require("message").danger(a)}),g=this.require("DesignerState"),h=new g,this.state(h),k=this.require("System");var o=this.require("storage").get("system-designer-systems");switch(!0){case window.location.href.split("#").length>1&&window.location.href.split("#")[1].length>0:l=window.location.href.split("#")[1],this.require("storage").get(l)&&(this.system(new k(this.require("storage").get(l))),this.refresh());break;default:o&&o.systems&&o.systems.length&&o.systems[0].length&&this.system(new k(this.require("storage").get(o.systems[0]))),this.refresh()}this.welcome();var p=this;window.onhashchange=function(a){var b=window.location.href.split("#"),c="",d="system",e="",f=0,g=0,h=null,i=null;for(b.length>1&&(c=b[1],c=c.split("?")[0]),b.length>2&&(d=b[2],d=d.split("?")[0]),b.length>3&&(e=b[3],e=e.split("?")[0]),b.length>4?p.state().component(b[4].split("?")[0]):p.state().component(""),b.length>1&&c?p.system(new k(p.require("storage").get(c))):o&&o.systems&&o.systems.length&&p.system(new k(p.require("storage").get(o.systems[0]))),p.space(e),p.context(d),i=document.getElementById("designer-menubar-items"),g=p.menubar().items().length,f=0;f<g;f++)h=i.children[f],$(h).removeClass("active");for(f=0;f<g;f++)p.menubar().items(f).name()===d&&(h=i.children[f],$(h).addClass("active"));p.updateRouter()},$(window).resize(function(){jsPlumb.repaintEverything()}),this.menubar().render(),this.toolbar().render(),this.spaces().render(),$(function(){$('[data-toggle="tooltip"]').tooltip({container:"body",delay:{show:2e3,hide:100},trigger:"hover"})}),this.server().start(),this.runMessages(this.messages()),this.messages([])}),F.on("filter",function(a){var b=[],c="";switch(this.context()){case"behaviors":c="ModelBehavior";break;case"schemas":c="ModelSchema";break;case"types":c="ModelType";break;case"models":c="ModelClass";break;case"components":c="ModelComponent";break;case"system":c="ModelSystem"}for(var d=this.require("db").collections()[c].find({}),e=0;e<d.length;e++)b.push(this.require(d[e]._id));switch(a.length>0?b.forEach(function(b){b.content().toLowerCase().indexOf(a.toLowerCase())===-1?b.hide():b.show()}):b.forEach(function(a){a.show()}),this.context()){case"schemas":case"models":jsPlumb.repaintEverything()}}),F.on("context",function(a){jsPlumb.ready(function(){jsPlumb.deleteEveryEndpoint()}),this.spaces().render(),this.workspace().clear(),this.workspace().refresh()}),F.on("space",function(a){"system"===this.context()&&this.updateRouter()}),F.on("updateRouter",function(){var a=[],b=0,c=0,d="",e="";if(this.require("designer").system())for(a=$("#designer-menubar-items > li > a"),c=a.length,b=0;b<c;b++)e=a[b].href,d=e.split("#")[e.split("#").length-1],a[b].href="#"+this.require("designer").system().id()+"#"+d;else for(a=$("#designer-menubar-items > li > a"),c=a.length,b=0;b<c;b++)e=a[b].href,d=e.split("#")[e.split("#").length-1],a[b].href="##"+d}),F.on("createBehavior",function(a,b,c,d){function e(a,b,c,d){var e={},f="",g=!1,h=!0;if("method"===a){for(f in d)if(e=d[f],e.component===b&&e.state===c){g=!0;break}g&&(h=!1)}return h}function f(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var g="",h=this.system().behaviors();if(e(a,b,c,h)){if(uuid=f(),methodDef=d.params,methodDef&&methodDef.length)for(length=methodDef.length,i=0;i<length;i++)0===i?params=methodDef[i].name:params=params+", "+methodDef[i].name;if(result=d.result,result)switch(result){case"string":g="\tvar result = '';\n\treturn result;\n";break;case"array":g="\tvar result = [];\n\treturn result;\n";break;case"number":g="\tvar result = 0;\n\treturn result;\n";break;case"object":g="\tvar result = {};\n\treturn result;\n";break;default:g="\tvar result = {};\n\treturn result;\n"}behavior={_id:uuid,component:b,state:c,action:"function "+c+"("+params+") { \n"+g+"}",useCoreAPI:!1,core:!1},h[uuid]=behavior,this.system().behaviors(h),this.save(),this.require("channel").createBehavior(behavior)}}),F.on("deleteSchema",function(a){function b(a,b){var c="",d="";for(d in b)if(b[d]._name===a){c=d;break}return c}var c="",d="",e=null,f=this.system().schemas(),g=this.system().models(),h=this.system().behaviors(),i=this.system().components(),j=f[a]._name;delete i[j],this.system().components(i);for(c in h)e=h[c],e.component===j&&(delete h[c],this.system().behaviors(h));d=b(f[a]._name,g),d&&(delete g[d],this.system().models(g)),delete f[a],this.system().schemas(f)}),F.on("createModel",function(a){function b(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var c=(this.system().schemas(),this.system().models()),d=this.system().components(),e="",f="",g="",h=null,i=null;f=b(),i={_id:f,_name:a._name};for(g in a)if(0!==g.indexOf("_"))switch(!0){case"property"===a[g]:i[g]={type:"string",readOnly:!1,mandatory:!1,default:""};for(h in d[e])d[e][h][g]=i[g].default,this.require("channel").updateComponent(h,e,d[e][h]);break;case"link"===a[g]:i[g]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,default:{}};for(h in d[e])d[e][h][g]=i[g].default,this.require("channel").updateComponent(h,e,d[e][h]);break;case"method"===a[g]:i[g]={params:[{name:"param",type:"string",mandatory:!1,default:""}],result:"string"};for(h in d[e])d[e][h][g]=i[g].default,this.require("channel").updateComponent(h,e,d[e][h]);break;case"event"===a[g]:i[g]={params:[{name:"param",type:"string",mandatory:!1,default:""}]};for(h in d[e])d[e][h][g]=i[g].default,this.require("channel").updateComponent(h,e,d[e][h]);break;case"collection"===a[g]:i[g]={type:["string"],readOnly:!1,mandatory:!1,default:[]};for(h in d[e])d[e][h][g]=i[g].default,this.require("channel").updateComponent(h,e,d[e][h])}c[f]=i,this.system().models(c),this.require("channel").createModel(i._id,i),this.system().components(d),this.save()}),F.on("syncComponent",function(a){function b(a,b){var c="",d="";for(d in b)if(b[d]._name===a){c=b[d];break}return c}var c=this.system().schemas(),d=this.system().components(),e="",f="",g=null;e=a._name,schema=b(e,c);for(f in schema)switch(!0){case"property"===schema[f]:for(g in d[e])"undefined"==typeof d[e][g][f]&&(d[e][g][f]=a[f].default,this.require("channel").updateComponent(g,e,d[e][g]),this.system().components(d));break;case"link"===schema[f]:for(g in d[e])"undefined"==typeof d[e][g][f]&&(d[e][g][f]=a[f].default,this.require("channel").updateComponent(g,e,d[e][g]),this.system().components(d));break;case"collection"===schema[f]:for(g in d[e])"undefined"==typeof d[e][g][f]&&(d[e][g][f]=a[f].default,this.require("channel").updateComponent(g,e,d[e][g]),this.system().components(d))}this.save()}),F.on("syncModel",function(a){function b(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var c=this.system().schemas(),d=this.system().models(),e=this.system().components(),f=this.system().behaviors(),g="",h="",i="",j=null,k=null,l=null,m=null,n=!1;g=a._name;for(h in d)d[h]._name===a._name&&(l=d[h]);l||(n=!0,l={_id:b(),_name:g}),m=c[a._id];for(i in a)if(a.hasOwnProperty(i)&&m&&("undefined"==typeof m[i]||m[i]!==a[i])||n)switch(!0){case"property"===a[i]:l[i]={type:"any",readOnly:!1,mandatory:!1,default:null};for(j in e[g])e[g][j][i]=l[i].default,this.require("channel").updateComponent(j,g,e[g][j]),this.system().components(e);break;case"link"===a[i]:l[i]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,default:{}};for(j in e[g])e[g][j][i]=l[i].default,this.require("channel").updateComponent(j,g,e[g][j]),this.system().components(e);break;case"method"===a[i]:("undefined"==typeof l[i]||"undefined"!=typeof l[i]&&"undefined"!=typeof l[i].type)&&(l[i]={params:[{name:"param",type:"string",mandatory:!1,default:""}],result:"string"},this.createBehavior("method",l._name,i,l[i]));break;case"event"===a[i]:"undefined"==typeof l[i]||"undefined"!=typeof l[i]&&"undefined"!=typeof l[i].type?(l[i]={params:[{name:"param",type:"string",mandatory:!1,default:""}]},this.createBehavior("event",l._name,i,l[i])):"undefined"!=typeof l[i].result&&delete l[i].result;break;case"collection"===a[i]:l[i]={type:["@RuntimeComponent"],readOnly:!1,mandatory:!1,default:[]};for(j in e[g])e[g][j][i]=l[i].default,this.require("channel").updateComponent(j,g,e[g][j]),this.system().components(e);break;case 1!==i.indexOf("_"):"_id"!==i&&"_inherit"!==i&&(l[i]=a[i])}if(m)for(i in m)if(0!==i.indexOf("_")&&"undefined"==typeof a[i]){delete l[i];for(j in e[g])delete e[g][j][i],this.require("channel").deleteComponent(j,g),this.system().components(e);for(k in f)l&&f[k].component===l._name&&f[k].state===i&&(delete f[k],this.require("channel").deleteBehavior(k),this.system().behaviors(f))}d[l._id]=l,this.system().models(d),this.require("channel").updateModel(l._id,l),this.save()}),F.on("syncBehavior",function(a){function b(a){var b="",c="";for(c in o.system().schemas())if(o.system().schemas()[c]._name===a){b=o.system().schemas()[c];break}return b}var c=this.system().behaviors(),d=null,e="",f="",g="",h=null,i=null,j=0,k=0,l="",m="",n=null,o=this;d=b(a._name);for(e in d)switch(!0){case"method"===d[e]:case"event"===d[e]:if(h=a[e],"undefined"==typeof h&&(h="method"===d[e]?{params:[{name:"param",type:"string",mandatory:!1,default:""}],result:"string"}:{params:[{name:"param",type:"string",mandatory:!1,default:""}]}),i=h.params,i&&i.length)for(j=i.length,k=0;k<j;k++)f=0===k?i[k].name:f+", "+i[k].name;g="function "+e+"("+f+") ";for(l in c)n=c[l],n.component===a._name&&n.state===e&&(m=n.action.split("{"),m[0]=g,c[l].action=m.join("{"),this.system().behaviors(c),this.require("channel").updateBehavior(n._id,n),this.save())}}),F.on("linkModel",function(a,b){jsPlumb.ready(function(){jsPlumb.setContainer("body"),jsPlumb.connect({paintStyle:{strokeStyle:"#7F949D",lineWidth:3},source:"designer-model-panel-"+a,target:"designer-model-panel-"+b,overlays:[["Arrow",{location:1}]]},{connector:["Flowchart"],anchor:["Left","Right"],endpoint:"Blank"})})}),F.on("save",function(){var a=this.require("storage").get("system-designer-systems"),b=this.require("designer"),c=this.require("db").collections().System.find({_id:b.system().id()})[0],d=c._id;this.require("storage").set(d,c),a?a.systems.indexOf(d)===-1&&a.systems.push(d):a={systems:[d]},this.require("storage").set("system-designer-systems",a)}),F.on("runMessages",function(a){a.forEach(function(a){console.log(a),$db.RuntimeMessage.insert(a)})},!0),a.on("main",function(){var a=null;a=this.require("designer"),a.render()}),a.main()});