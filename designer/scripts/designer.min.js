/*
* System Designer
* https://system-designer.github.io
* @ecarriou
*
* Copyright (C) 2016 - Erwan Carriou
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
runtime.on("ready",function(){var a=this.system("design"),b=this.require("DialogImport");b.on("init",function(a){var b="",c=null;$("#designer-dialog-import").empty(),b=this.require("dialog-modal-import.html"),document.querySelector("#designer-dialog-import").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-import-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-import-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),b.on("show",function(){$("#designer-dialog-import-modal").modal("show")}),b.on("hide",function(){$("#designer-dialog-import-modal").modal("hide")});var c=this.require("DialogCheck");c.on("init",function(a){var b="",c=null;$("#designer-dialog-check").empty(),b=this.require("dialog-modal-check.html"),document.querySelector("#designer-dialog-check").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-check-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),c.on("show",function(){$("#designer-dialog-check-modal").modal("show")}),c.on("hide",function(){$("#designer-dialog-check-modal").modal("hide")}),c.on("ok",function(){this.hide()});var d=this.require("DialogWelcome");d.on("init",function(a){var b="",c=null;$("#designer-dialog-welcome").empty(),b=this.require("dialog-modal-welcome.html"),document.querySelector("#designer-dialog-welcome").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-welcome-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),d.on("show",function(){$("#designer-dialog-welcome-modal").modal("show")}),d.on("hide",function(){$("#designer-dialog-welcome-modal").modal("hide")});var e=this.require("DialogSync");e.on("init",function(a){var b="",c=null;$("#designer-dialog-sync").empty(),b=this.require("dialog-modal-sync.html"),document.querySelector("#designer-dialog-sync").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-sync-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),e.on("show",function(){$("#designer-dialog-sync-modal").modal("show")}),e.on("hide",function(){$("#designer-dialog-sync-modal").modal("hide")});var f=this.require("DialogShare");f.on("init",function(a){var b=null,c=null,d="";$("#designer-dialog-share").empty(),d=this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0],b=this.require("dialog-modal-share.html"),document.querySelector("#designer-dialog-share").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,window.location.toString().split("#")[0]+"?system="+encodeURI(JSON.stringify(d)))),c=document.getElementById("designer-dialog-share-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-share-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),f.on("show",function(){$("#designer-dialog-share-modal").modal("show")}),f.on("hide",function(){$("#designer-dialog-share-modal").modal("hide")});var g=this.require("DialogCopyright");g.on("init",function(a){var b="",c=null;$("#designer-dialog-copyright").empty(),b=this.require("dialog-modal-copyright.html"),document.querySelector("#designer-dialog-copyright").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-copyright-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),g.on("show",function(){$("#designer-dialog-copyright-modal").modal("show")}),g.on("hide",function(){$("#designer-dialog-copyright-modal").modal("hide")});var h=this.require("DialogConfig");h.on("init",function(a){var b="",c=null,d=this,e=d.require("designer");$("#designer-dialog-config").empty(),b=this.require("dialog-modal-config.html"),document.querySelector("#designer-dialog-config").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),$("#designer-dialog-type-config-isdebug")[0].checked=e.debug(),c=document.getElementById("designer-dialog-config-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-config-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this)),c=document.getElementById("designer-dialog-type-config-reset"),c.addEventListener("click",function(a){this.require("System");window.localStorage.clear(),this.require("designer").system().destroy(),this.require("designer").spaces().clear(),this.require("designer").workspace().clear(),this.require("designer").updateRouter(),this.require("message").success("system designer has been reseted.")}.bind(this)),c=document.getElementById("designer-dialog-type-config-isdebug"),c.addEventListener("click",function(a){var b=d.require("designer"),c=!1;c=$("#designer-dialog-type-config-isdebug")[0].checked,c?b.debug(!0):b.debug(!1)})}),h.on("show",function(){$("#designer-dialog-config-modal").modal("show")}),h.on("hide",function(){$("#designer-dialog-config-modal").modal("hide")});var j=this.require("DialogImportFile");j.on("init",function(a){var b="",c=null,d=this,e=[],f="",g=0,h=0,i="";for($("#designer-dialog-import-file").empty(),e=this.require("db").collections().JSON.find(),g=e.length,h=0;g>h;h++)f=this.require(e[h]._id),i=i+'<a class="list-group-item" id="designer-dialog-import-file-modal-library-'+f.id()+'"><h4 class="list-group-item-heading">'+JSON.parse(decodeURI(f.source())).name+'</h4><p class="list-group-item-text">'+JSON.parse(decodeURI(f.source())).description+"</p></a>";b=this.require("dialog-modal-import-file.html"),document.querySelector("#designer-dialog-import-file").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{library}}/gi,i));var j=function(a){var b="",c=null,e=0,f=0;if($(this).hasClass("active"))$(this).removeClass("active"),d.data(null);else{for(b=this.getAttribute("id").replace("designer-dialog-import-file-modal-library-",""),d.data(JSON.parse(decodeURI(d.require(b).source()))),c=document.getElementById("designer-dialog-import-file-modal-library"),e=c.children.length,f=0;e>f;f++)$(c.children[f]).removeClass("active");$(this).addClass("active")}};for(h=0;g>h;h++)f=this.require(e[h]._id),c=document.getElementById("designer-dialog-import-file-modal-library-"+f.id()),c.addEventListener("click",j);c=document.getElementById("designer-dialog-import-modal-from-file"),c.addEventListener("click",function(a){$("#designer-dialog-import-file-modal-file").show(),$("#designer-dialog-import-file-modal-well").hide()}.bind(this)),c=document.getElementById("designer-dialog-import-modal-from-library"),c.addEventListener("click",function(a){$("#designer-dialog-import-file-modal-well").show(),$("#designer-dialog-import-file-modal-file").hide()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-merge"),c.addEventListener("click",function(a){this.mergeSystem()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-import"),c.addEventListener("click",function(a){this.importSystem()}.bind(this)),c=document.getElementById("designer-dialog-import-file-modal-file"),c.addEventListener("change",function(a){a.stopPropagation(),a.preventDefault();var b=a.target.files,c=new FileReader,d="",e=this;c.onload=function(a){d+=a.target.result},c.onloadend=function(){try{e.data(JSON.parse(d))}catch(a){e.data({})}},c.readAsText(b[0],"UTF-8")}.bind(this))}),j.on("show",function(){$("#designer-dialog-import-file-modal").modal("show")}),j.on("hide",function(){$("#designer-dialog-import-file-modal").modal("hide")});var k=this.require("DialogDropFile");k.on("init",function(a){var b=null,c=null;$("#designer-dialog-drop-file").empty(),b=this.require("dialog-modal-drop-file.html"),document.querySelector("#designer-dialog-drop-file").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{message}}/gi,this.message())),c=document.getElementById("designer-dialog-drop-file-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-drop-file-modal-merge"),c.addEventListener("click",function(a){this.mergeSystem()}.bind(this)),c=document.getElementById("designer-dialog-drop-file-modal-import"),c.addEventListener("click",function(a){this.importSystem()}.bind(this))}),k.on("mergeSystem",function(){var a=null,b="",c="",d="",e="",f=this.require("designer"),g=f.system(),h=this.require("message");if(a=this.data(),Object.keys(a).length){for(b in a.schemas)if(g.schemas()[b])for(d in a.schemas[b])g.schemas()[b][d]=a.schemas[b][d];else g.schemas()[b]=a.schemas[b];for(b in a.models)if(g.models()[b])for(d in a.models[b])g.models()[b][d]=a.models[b][d];else g.models()[b]=a.models[b];for(b in a.types)if(g.types()[b])for(d in a.types[b])g.types()[b][d]=a.types[b][d];else g.types()[b]=a.types[b];for(b in a.behaviors)b!==a._id&&(g.behaviors()[b]=a.behaviors[b]);for(c in a.components){g.components()[c]||(g.components()[c]={});for(e in a.components[c])if(g.components()[c][e])for(d in a.components[c][e])g.components()[c][e][d]=a.components[c][e][d];else g.components()[c][e]=a.components[c][e]}}f.save(),f.workspace().refresh(),this.hide(),f.save(),h.success("merge of the system is done.")}),k.on("importSystem",function(){var a=this.require("System"),b=null,c=this.require("designer"),d=this.require("message");c.system()&&c.system().destroy(),b=new a(this.data()),c.system(b),c.save(),c.space(b.name()),c.spaces().render(),c.workspace().refresh(),this.hide(),c.save(),d.success("importation of the system is done.")}),k.on("show",function(){$("#designer-dialog-drop-file-modal").modal("show")}),k.on("hide",function(){$("#designer-dialog-drop-file-modal").modal("hide")});var l=this.require("DialogTypeCreation");l.on("init",function(a){var b="",c=null;$("#designer-dialog-type-creation").empty(),b=this.require("dialog-modal-type-creation.html"),document.querySelector("#designer-dialog-type-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-type-creation-name"),c.addEventListener("keydown",function(a){return 13===a.keyCode?(a.stopPropagation(),a.preventDefault(),$("#designer-dialog-type-creation-name").val()&&this.ok(),!1):void 0}.bind(this)),c=document.getElementById("designer-dialog-type-creation-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-type-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),l.on("show",function(){$("#designer-dialog-type-creation-modal").modal("show")}),l.on("hide",function(){$("#designer-dialog-type-creation-modal").modal("hide")});var m=this.require("DialogExport");m.on("init",function(a){var b="",c=null;$("#designer-dialog-export").empty(),b=this.require("dialog-modal-export.html"),document.querySelector("#designer-dialog-export").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-export-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-export-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),m.on("show",function(){$("#designer-dialog-export-modal").modal("show")}),m.on("hide",function(){$("#designer-dialog-export-modal").modal("hide")});var n=this.require("DialogSchemaCreation");n.on("init",function(a){var b="",c=null;$("#designer-dialog-schema-creation").empty(),b=this.require("dialog-modal-schema-creation.html"),document.querySelector("#designer-dialog-schema-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-schema-creation-name"),c.addEventListener("keydown",function(a){return 13===a.keyCode?(a.stopPropagation(),a.preventDefault(),$("#designer-dialog-schema-creation-name").val()&&this.ok(),!1):void 0}.bind(this)),c=document.getElementById("designer-dialog-schema-creation-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-schema-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),n.on("show",function(){$("#designer-dialog-schema-creation-modal").modal("show")}),n.on("hide",function(){$("#designer-dialog-schema-creation-modal").modal("hide")});var o=this.require("DialogSystemCreation");o.on("init",function(a){var b="",c=null;$("#designer-dialog-system-creation").empty(),b=this.require("dialog-modal-system-creation.html"),document.querySelector("#designer-dialog-system-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title())),c=document.getElementById("designer-dialog-system-creation-name"),c.addEventListener("keydown",function(a){return 13===a.keyCode?(a.stopPropagation(),a.preventDefault(),$("#designer-dialog-system-creation-name").val()&&this.ok(),!1):void 0}.bind(this)),c=document.getElementById("designer-dialog-system-creation-modal-cancel"),c.addEventListener("click",function(a){this.cancel()}.bind(this)),c=document.getElementById("designer-dialog-system-creation-modal-ok"),c.addEventListener("click",function(a){this.ok()}.bind(this))}),o.on("show",function(){$("#designer-dialog-system-creation-modal").modal("show")}),o.on("hide",function(){$("#designer-dialog-system-creation-modal").modal("hide")});var p=this.require("DialogModelCreation");p.on("init",function(a){var b="",c="",d=null,e="",f=this.require("designer"),g=f.system().schemas();$("#designer-dialog-model-creation").empty();for(c in g)e=e+'<option value="'+c+'">'+c+"</option>";b=this.require("dialog-modal-model-creation.html"),document.querySelector("#designer-dialog-model-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{schemas}}/gi,e)),d=document.getElementById("designer-dialog-model-creation-name"),d.addEventListener("keydown",function(a){return 13===a.keyCode?(a.stopPropagation(),a.preventDefault(),$("#designer-dialog-model-creation-name").val()&&this.ok(),!1):void 0}.bind(this)),d=document.getElementById("designer-dialog-model-creation-modal-cancel"),d.addEventListener("click",function(a){this.cancel()}.bind(this)),d=document.getElementById("designer-dialog-model-creation-modal-ok"),d.addEventListener("click",function(a){this.ok()}.bind(this))}),p.on("show",function(){$("#designer-dialog-model-creation-modal").modal("show")}),p.on("hide",function(){$("#designer-dialog-model-creation-modal").modal("hide")});var q=this.require("DialogBehaviorCreation");q.on("init",function(a){function b(a){var b="",c="";for(c in g.system().schemas())if(g.system().schemas()[c]._name===a){b=c;break}return b}var c="",d=null,e="",f=[],g=this.require("designer"),h=this.require("designer").space(),i=(g.system().schemas(),g.system().models(),""),j="";if($("#designer-dialog-behavior-creation").empty(),h!==g.system().name()){i=b(h),f.push("init"),f.push("destroy");for(j in g.system().schemas()[i])switch(g.system().schemas()[i][j]){case"property":case"link":case"collection":case"event":case"method":f.push(j)}}else f.push("main");f.sort(),f.forEach(function(a){e=e+'<option value="'+a+'">'+a+"</option>"}),c=this.require("dialog-modal-behavior-creation.html"),document.querySelector("#designer-dialog-behavior-creation").insertAdjacentHTML("afterbegin",c.source().replace(/{{title}}/gi,this.title()).replace(/{{states}}/gi,e)),d=document.getElementById("designer-dialog-behavior-creation-modal-cancel"),d.addEventListener("click",function(a){this.cancel()}.bind(this)),d=document.getElementById("designer-dialog-behavior-creation-modal-ok"),d.addEventListener("click",function(a){this.ok()}.bind(this))}),q.on("show",function(){$("#designer-dialog-behavior-creation-modal").modal("show")}),q.on("hide",function(){$("#designer-dialog-behavior-creation-modal").modal("hide")});var r=this.require("DialogComponentCreation");r.on("init",function(a){var b="",c="",d=null,e="",f=this.require("designer"),g=f.system().models();$("#designer-dialog-component-creation").empty();for(c in g)g[c]._schema&&(e=e+'<option value="'+c+'">'+c+"</option>");b=this.require("dialog-modal-component-creation.html"),document.querySelector("#designer-dialog-component-creation").insertAdjacentHTML("afterbegin",b.source().replace(/{{title}}/gi,this.title()).replace(/{{models}}/gi,e)),d=document.getElementById("designer-dialog-component-creation-modal-cancel"),d.addEventListener("click",function(a){this.cancel()}.bind(this)),d=document.getElementById("designer-dialog-component-creation-modal-ok"),d.addEventListener("click",function(a){this.ok()}.bind(this))}),r.on("show",function(){$("#designer-dialog-component-creation-modal").modal("show")}),r.on("hide",function(){$("#designer-dialog-component-creation-modal").modal("hide")});var s=this.require("ModelSystem");s.on("render",function(){var a=null,b=this,c="",d="",e="";a=this.require("model-system.html");for(d in this.document())-1!==["name","description","version"].indexOf(d)&&(e=this.document()[d],c=c+"<tr><td>"+d+"</td><td>"+e+"</td></tr>");document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{title}}/gi,this.title()).replace(/{{_id}}/gi,this.uuid()).replace(/{{content}}/gi,c)),a=document.getElementById("designer-system-"+this.uuid()).children[0].children[1],a.addEventListener("click",function(a){window.open("system.html?_id="+b.uuid())}),a=document.getElementById("designer-system-"+this.uuid()+"-edit"),a.addEventListener("click",function(a){window.open("system.html?_id="+b.uuid())}),a=document.getElementById("designer-system-"+this.uuid()+"-delete"),a.addEventListener("click",function(a){var b=JSON.parse(window.localStorage.getItem("systems")),c=this.require("designer"),d=this.require("System"),e=this.uuid();window.localStorage.removeItem(e),b.systems.splice(b.systems.indexOf(e),1),window.localStorage.setItem("systems",JSON.stringify(b)),c.system().destroy(),b.systems.length&&c.system(new d(JSON.parse(window.localStorage.getItem(b.systems[0])))),$("#designer-system-"+this.uuid()).remove(),this.destroy(),c.space(""),c.spaces().render(),c.workspace().refresh()}.bind(this))}),s.on("hide",function(){$("#designer-system-"+this.uuid()).hide()}),s.on("show",function(){$("#designer-system-"+this.uuid()).show()});var t=this.require("ModelType");t.on("render",function(){var a=null,b=this,c="",d="",e="";if(a=this.require("model-type.html"),this.document().schema)for(d in this.document().schema)this.document().schema.hasOwnProperty(d)&&(e=this.document().schema[d].type,c=c+'<a class="list-group-item" style="text-align: left">'+d+" : "+e+"</a>");this.document().value&&this.document().value.forEach(function(a){c=c+'<a class="list-group-item" style="text-align: left">'+a+"</a>"}),this.document().schema||this.document().value||(e=this.document().type,c=c+'<a class="list-group-item" style="text-align: left"><i>alias</i> : '+e+"</a>"),""===c&&(c+='<a class="list-group-item" style="text-align: left"><br/><br/></a>'),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{title}}/gi,this.title()).replace(/{{id}}/gi,this.uuid()).replace(/{{content}}/gi,c)),a=document.getElementById("designer-type-"+this.uuid()).children[0].children[1],a.addEventListener("click",function(a){window.open("type.html?_id="+b.uuid())}),a=document.getElementById("designer-type-"+this.uuid()+"-edit"),a.addEventListener("click",function(a){window.open("type.html?_id="+b.uuid())}),a=document.getElementById("designer-type-"+this.uuid()+"-delete"),a.addEventListener("click",function(a){var b=this.require("designer");delete b.system().types()[this.title()],$("#designer-type-"+this.title()).remove(),this.require("channel").deleteType(this.uuid()),this.destroy(),b.save(),b.space(""),b.spaces().render(),b.workspace().refresh()}.bind(this))}),t.on("hide",function(){$("#designer-type-"+this.title()).hide()}),t.on("show",function(){$("#designer-type-"+this.title()).show()});var u=this.require("ModelSchema");u.on("render",function(){var a=null,b="",c=this,d="",e="";a=this.require("model-schema.html");for(d in this.document())this.document().hasOwnProperty(d)&&0!==d.indexOf("_")&&(e=this.document()[d],b=b+"<tr><td>"+d+"</td><td>"+e+"</td></tr>");""===b&&(b+="<tr><td><br/><br/><br/></td><td><br/><br/><br/></td></tr>"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{title}}/gi,this.title()).replace(/{{id}}/gi,this.uuid()).replace(/{{content}}/gi,b)),"111df11e2b19fde"!==this.uuid()?(a=document.getElementById("designer-schema-"+this.uuid()).children[0].children[1],a.addEventListener("click",function(a){window.open("schema.html?_id="+c.uuid())}),a=document.getElementById("designer-schema-"+this.uuid()+"-edit"),a.addEventListener("click",function(a){window.open("schema.html?_id="+c.uuid())}),a=document.getElementById("designer-schema-"+this.uuid()+"-delete"),a.addEventListener("click",function(a){var b=this.require("designer");b.deleteSchema(this.uuid()),$("#designer-schema-"+this.uuid()).remove(),this.require("channel").deleteSchema(this.uuid()),this.destroy(),jsPlumb.deleteEveryEndpoint(),b.save(),b.space(""),b.spaces().render(),b.workspace().refresh()}.bind(this))):($("#designer-model-panel-111df11e2b19fde div div").hide(),$("#designer-schema-111df11e2b19fde > div > .panel-body").attr("style","cursor: inherit"))}),u.on("hide",function(){$("#designer-schema-"+this.title()).hide()}),u.on("show",function(){$("#designer-schema-"+this.title()).show()});var v=this.require("ModelClass");v.on("render",function(){function a(a){var b="",d="";for(d in c.require("designer").system().models())if(c.require("designer").system().models()[d]._name===a){b=d;break}return b}var b=null,c=this,d="",e="",f="",g="",h="",i="",j="",k=null,l=null;k=function(a){m=m+a.name+" : "+a.type+", "};for(d in this.document())if(this.document().hasOwnProperty(d))switch(i=this.document()[d],!0){case"undefined"!=typeof i.type:e=Array.isArray(i.type)?-1!==i.type[0].indexOf("@")?"123751cb591de26"!==this.uuid()?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#models#"+a(i.type[0].replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type[0].replace("@","")+"</a> [ ]</div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type[0].replace("@","")+" [ ]</div>":-1===["any","boolean","string","number","object","function","array","html","javascript","css"].indexOf(i.type)?"123751cb591de26"!==this.uuid()?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#types#"+i.type[0]+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type[0].replace("@","")+"</a> [ ]</div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type[0].replace("@","")+" [ ]</div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type[0]+" [ ]</div>":-1!==i.type.indexOf("@")?"123751cb591de26"!==this.uuid()&&"@RuntimeComponent"!==i.type?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#models#"+a(i.type.replace("@",""))+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type.replace("@","")+"</a></div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type.replace("@","")+"</div>":-1===["any","boolean","string","number","object","function","array","html","javascript","css"].indexOf(i.type)&&"123751cb591de26"!==this.uuid()?e+'<div class="list-group-item" style="text-align: left">+ '+d+' : <a href="#'+this.require("designer").system().id()+"#types#"+i.type+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+i.type+"</a></div>":e+'<div class="list-group-item" style="text-align: left">+ '+d+" : "+i.type+"</div>";break;case"undefined"!=typeof i.params:j="undefined";var m="(";i.params.forEach(k),m+=")",m=m.replace(", )",")"),"undefined"!=typeof i.result?(j=i.result,g="123751cb591de26"!==this.uuid()?g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>"+m+": "+j+"</div>":g+'<div class="list-group-item" style="text-align: left">+ '+d+m+": "+j+"</div>"):g="123751cb591de26"!==this.uuid()?g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>"+m+"</div>":g+'<div class="list-group-item" style="text-align: left">+ '+d+m+"</div>";break;case-1!==d.indexOf("_"):break;default:j="undefined","undefined"!=typeof i.result?(j=i.result,g="123751cb591de26"!==this.uuid()?g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>(): "+j+"</div>":g+'<div class="list-group-item" style="text-align: left">+ '+d+"(): "+j+"</div>"):g="123751cb591de26"!==this.uuid()?g+'<div class="list-group-item" style="text-align: left">+ <a href="#'+this.require("designer").system().id()+"#behaviors#"+this.document()._name+"#"+d+'" onclick="(function (e) {e.stopPropagation();})(arguments[0])">'+d+"</a>()</div>":g+'<div class="list-group-item" style="text-align: left">+ '+d+"()</div>"}""===e&&(e+='<a class="list-group-item" style="text-align: left"><br/></a>'),""===g&&(g+='<a class="list-group-item" style="text-align: left"><br/></a>'),l=this.require("model-class.html"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",l.source().replace(/{{title}}/gi,this.title()).replace(/{{_id}}/gi,this.uuid()).replace(/{{attributes}}/gi,e).replace(/{{collections}}/gi,f).replace(/{{methods}}/gi,g).replace(/{{events}}/gi,h)),"123751cb591de26"!==this.uuid()?(b=document.getElementById("designer-model-"+this.uuid()).children[0].children[1],b.addEventListener("click",function(a){window.open("model.html?_id="+c.uuid())}),b=document.getElementById("designer-model-"+this.uuid()+"-edit"),b.addEventListener("click",function(a){window.open("schema.html?_id="+c.uuid())}),b=document.getElementById("designer-model-"+this.uuid()+"-delete"),b.addEventListener("click",function(a){var b=this.require("designer");delete b.system().models()[this.uuid()],delete b.system().components()[this.uuid()],$("#designer-model-"+this.uuid()).remove(),this.require("channel").deleteModel(this.uuid()),this.destroy(),jsPlumb.deleteEveryEndpoint(),b.save(),b.space(""),b.spaces().render(),b.workspace().refresh()}.bind(this))):($("#designer-model-123751cb591de26 > div > div > div > button").hide(),$("#designer-model-123751cb591de26 > div > .panel-body").attr("style","cursor: inherit"))}),v.on("hide",function(){$("#designer-class-"+this.title()).hide()}),v.on("show",function(){$("#designer-class-"+this.title()).show()});var w=this.require("ModelBehavior");w.on("render",function(){var a="",b=null,c=this;a=this.require("model-behavior.html"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{_id}}/gi,this.uuid()).replace(/{{title}}/gi,this.title()).replace(/{{content}}/gi,this.content())),b=document.getElementById("designer-behavior-"+this.uuid()).children[0].children[1],b.addEventListener("click",function(a){window.open("behavior.html?_id="+c.uuid())}),b=document.getElementById("designer-behavior-"+this.uuid()+"-edit"),b.addEventListener("click",function(a){window.open("behavior.html?_id="+c.uuid())}),b=document.getElementById("designer-behavior-"+this.uuid()+"-delete"),b.addEventListener("click",function(a){var b=this.require("designer");delete b.system().behaviors()[this.uuid()],$("#designer-behavior-"+this.uuid()).fadeOut(400,function(){$(this).remove()}),this.require("channel").deleteBehavior(this.uuid()),this.destroy(),b.save()}.bind(this))}),w.on("hide",function(){$("#designer-behavior-"+this.uuid()).hide()}),w.on("show",function(){$("#designer-behavior-"+this.uuid()).show()});var x=this.require("ModelComponent");x.on("render",function(){var a=null,b=null,c="",d=this,e="",f="";for(e in this.document())this.document().hasOwnProperty(e)&&"_id"!==e&&(f=this.document()[e],c=c+"<tr><td>"+e+"</td><td>"+JSON.stringify(f)+"</td></tr>");""===c&&(c+="<tr><td><br/><br/></td><td><br/><br/></td></tr>"),a=this.require("model-component.html"),document.querySelector("#designer-workspace").insertAdjacentHTML("afterbegin",a.source().replace(/{{title}}/gi,this.title()).replace(/{{_id}}/gi,this.uuid()).replace(/{{content}}/gi,c)),b=document.getElementById("designer-component-"+this.uuid()).children[0].children[1],b.addEventListener("click",function(a){window.open("component.html?_id="+encodeURI(d.title())+"&model="+encodeURI(d.model()))}),b=document.getElementById("designer-component-"+this.uuid()+"-edit"),b.addEventListener("click",function(a){window.open("component.html?_id="+encodeURI(d.title())+"&model="+encodeURI(d.model()))}),b=document.getElementById("designer-component-"+this.uuid()+"-delete"),b.addEventListener("click",function(a){var b=this.require("designer");delete b.system().components()[this.model()][this.uuid()],$("#designer-component-"+this.uuid()).fadeOut(400,function(){$(this).remove()}),this.require("channel").deleteComponent(this.uuid(),this.model()),this.destroy(),b.save()}.bind(this))}),x.on("hide",function(){$("#designer-component-"+this.uuid()).hide()}),x.on("show",function(){$("#designer-component-"+this.uuid()).show()});var y=this.require("MenuBar");y.on("init",function(a){var b=[],c=[],d=[],e=this;b=this.require("db").collections().MenuHeader.find({type:"designer"}),this.header(this.require(b[0]._id)),c=this.require("db").collections().MenuItem.find({type:"designer"}),c.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),c.forEach(function(a){var b=a._id;e.items().push(e.require(b))}),d=this.require("db").collections().MenuAction.find({type:"designer"}),d.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),d.forEach(function(a){var b=a._id;e.actions().push(e.require(b))})}),y.on("render",function(){function a(){var a=0,b=0,c=null;for(a=f.children.length,b=0;a>b;b++)c=f.children[b],$(c).removeClass("active")}var b=0,c=0,d=null,e=document.getElementById("designer-menubar-header"),f=document.getElementById("designer-menubar-items"),g=document.getElementById("designer-menubar-actions"),h=this,i=window.location.href.split("#"),j="system",k="",l=this.require("designer");e.insertAdjacentHTML("afterbegin",this.header().html().source()),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend","<li>"+a.html().source()+"</>")});var m=function(){a(),$(this).addClass("active")};for(b=f.children.length,c=0;b>c;c++)d=f.children[c],d.addEventListener("click",m),d.addEventListener("click",function(){this.click()}.bind(h.items(c)));for(this.actions().forEach(function(a){g.insertAdjacentHTML("afterbegin","<li>"+a.html().source()+"</>")}),i.length>2&&0!==i[2].length&&(j=i[2]),i.length>3&&(k=i[3]),i.length>4&&l.state().component(i[4]),c=0;b>c;c++)this.items(c).name()===j&&(d=f.children[c],
$(d).addClass("active"));k&&l.space(k),l.context(j);var n=this;$("#designer-menu-action-search").on("keyup",function(a){var b=$("#designer-menu-action-search").val();n.designer().filter(b)}),l.updateRouter()});var z=this.require("ToolBar");z.on("init",function(a){var b=[],c=this;b=this.require("db").collections().ToolBarItem.find({type:"designer"}),b.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),b.forEach(function(a){var b=a._id;c.items().push(c.require(b))})}),z.on("render",function(){var a=document.getElementById("designer-toolbar-items"),b=0,c=0,d=null,e=this;for(this.items().forEach(function(b){a.insertAdjacentHTML("beforeend","<li>"+b.html().source()+"</>")}),c=a.children.length,b=0;c>b;b++)d=a.children[b],d.addEventListener("click",function(){this.click()}.bind(e.items(b)))});var A=this.require("Spaces");A.on("init",function(a){}),A.on("clear",function(){this.require("designer").space(""),$("#designer-spaces-items").empty()}),A.on("render",function(){function a(){var a=0,b=0,c=null;for(a=f.children.length,b=0;a>b;b++)c=f.children[b],$(c).removeClass("active")}var b=null,c=this.designer().system(),d=this.require("SpaceItem"),e=null,f=document.getElementById("designer-spaces-items"),g=this,h="",i=null;switch($("#designer-spaces-help").empty(),this.designer().context()){case"system":document.getElementById("designer-spaces-type").innerHTML="Systems",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-system.html").source());break;case"schemas":document.getElementById("designer-spaces-type").innerHTML="Schemas",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-schemas.html").source());break;case"models":document.getElementById("designer-spaces-type").innerHTML="Models",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-models.html").source());break;case"types":document.getElementById("designer-spaces-type").innerHTML="Types",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-types.html").source());break;case"behaviors":document.getElementById("designer-spaces-type").innerHTML="Behaviors",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-behaviors.html").source());break;case"components":document.getElementById("designer-spaces-type").innerHTML="Components",document.getElementById("designer-spaces-help").insertAdjacentHTML("beforeend",this.require("help-components.html").source())}if($("#designer-spaces-items").empty(),c)switch(this.designer().context()){case"system":this.items().forEach(function(a){this.items().pop()}.bind(this));var j=JSON.parse(window.localStorage.getItem("systems")),k=[],l=0,m=0;for(j&&(k=j.systems),l=k.length,m=0;l>m;m++)c=JSON.parse(window.localStorage.getItem(k[m])),e=new d({name:c.name,uuid:c._id}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+a.uuid()+"#system#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;l>m;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));this.items().forEach(function(a){a.on("click",function(){var a=this.require("designer"),b=JSON.parse(window.localStorage.getItem(this.uuid())),c=this.require("System");b&&a.system(new c(b))})}),l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):this.require("designer").system()?$("#designer-space-"+this.require("designer").system().name()).length&&($("#designer-space-"+this.require("designer").system().name()).addClass("active"),this.require("designer").space(this.require("designer").system().name())):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())));break;case"schemas":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.schemas())"undefined"==typeof c.schemas()[h]._schema&&(e=new d({name:c.schemas()[h]._name,uuid:h}),this.items().push(e));for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.uuid()+'" class=""><a href="#'+c.id()+"#schemas#"+a.uuid()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;l>m;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0?$("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).uuid())):this.require("designer").space("");break;case"models":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.models())"undefined"!=typeof c.models()[h]._schema&&(e=new d({name:c.models()[h]._name,uuid:h}),this.items().push(e));for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.uuid()+'" class=""><a href="#'+c.id()+"#models#"+a.uuid()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;l>m;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0?$("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).uuid())):this.require("designer").space("");break;case"types":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.types())e=new d({name:h}),this.items().push(e);for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+c.id()+"#types#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;l>m;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())));break;case"behaviors":this.items().forEach(function(a){this.items().pop()}.bind(this)),e=new d({name:this.require("designer").system().name(),uuid:this.require("designer").system().id()}),this.items().push(e);for(h in c.models())"undefined"!=typeof c.models()[h]._schema&&(e=new d({name:c.models()[h]._name,uuid:h}),this.items().push(e));for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+c.id()+"#behaviors#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;l>m;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).uuid())));break;case"components":this.items().forEach(function(a){this.items().pop()}.bind(this));for(h in c.models())"undefined"!=typeof c.models()[h]._schema&&(e=new d({name:c.models()[h]._name,uuid:h}),this.items().push(e));for(this.items().sort(function(a,b){var c=runtime.require(a),d=runtime.require(b),e=0;return c.name()>d.name()&&(e=1),c.name()<d.name()&&(e=-1),e}),this.items().forEach(function(a){f.insertAdjacentHTML("beforeend",'<li id="designer-space-'+a.name()+'" class=""><a href="#'+c.id()+"#components#"+a.name()+'">'+a.name()+"</a></li>")}),i=function(){a(),$(this).addClass("active")},l=f.children.length,m=0;l>m;m++)b=f.children[m],b.addEventListener("click",i),b.addEventListener("click",function(){this.click()}.bind(g.items(m)));l>0&&($("#designer-space-"+this.require("designer").space()).length?$("#designer-space-"+this.require("designer").space()).addClass("active"):(b=f.children[0],$(b).addClass("active"),this.require("designer").space(this.items(0).name())))}});var B=this.require("Workspace");B.on("init",function(a){var b=this;$("html").on("dragenter dragover",!1).on("drop",function(a){a.stopPropagation(),a.preventDefault();var c=a.originalEvent.dataTransfer.files,d=new FileReader,e="";d.onload=function(a){e+=a.target.result},d.onloadend=function(){var a=JSON.parse(e),c=b.require("DialogDropFile");c=new c({title:"A system has been found",message:"What do you want to do ?"}),c.data(a),c.show()},d.readAsText(c[0],"UTF-8")})}),B.on("create",function(){function a(a){var b="",c="";for(c in h.system().models())if(h.system().models()[c]._name===a){b=c;break}return b}function b(a){var b="",c="";for(c in h.system().schemas())if(h.system().schemas()[c]._name===a){b=h.system().schemas()[c];break}return b}function c(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var d="",e=null,f=null,g=this.require("designer").system();switch(this.designer().context()){case"system":e=this.require("DialogSystemCreation"),f=new e({title:"Create a new system"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var b=this.require("designer"),c=null,d="",e="",f={},g=this.require("System"),h=null,i=null;c=$("#designer-dialog-system-creation-name").val(),c=c.trim(),c=c.replace(/ /gi,"_"),c&&(d=a(),e=a(),f={name:c,master:!1,subsystem:!1,version:"0.0.1",description:"",schemas:{},behaviors:{},types:{},components:{},_id:d},f.behaviors[e]={_id:e,component:d,state:"main",action:"function main() { \n}",useCoreAPI:!1,core:!1},b.system()&&b.system().destroy(),b.system(new g(f)),h=this.require("ModelSystem"),i=new h({title:c}),i.uuid=d,i.document(JSON.parse(JSON.stringify(f))),i.content(JSON.stringify(f)),b.save(),this.hide(),b.space(c),b.spaces().render(),b.workspace().refresh(),this.require("message").success("system created. You can now begin to create schemas."))});break;case"schemas":g&&Object.keys(g).length&&(e=this.require("DialogSchemaCreation"),f=new e({title:"Create a new schema"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var b=this.require("designer"),c=null,e={},f=null,g=null;c=$("#designer-dialog-schema-creation-name").val(),c=c.trim(),c=c.replace(/ /gi,"_"),c&&(d=a().toString(),e={_id:d,_name:c,_inherit:["RuntimeComponent"]},b.system().schemas()[d]=e,f=this.require("ModelSchema"),g=new f({title:c}),g.document(JSON.parse(JSON.stringify(e))),g.content(JSON.stringify(e)),g.uuid(d),b.save(),b.createModel(e),this.require("channel").createSchema(c,e),this.hide(),b.space(d),b.spaces().render(),b.workspace().refresh(),this.require("message").success("schema created. You can now edit it and generate models from this schema."))}));break;case"models":g&&Object.keys(g).length&&(e=this.require("DialogModelCreation"),f=new e({title:"Create a new model"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var b=this.require("designer"),c=null,e=null,f={},g=null,h=null;if(c=$("#designer-dialog-model-creation-name").val(),e=$("#designer-dialog-model-creation-schema").val(),c=c.trim(),c=c.replace(/ /gi,"_"),c&&e){d=a(),f={_id:d,_name:c,_schema:e,_inherit:["RuntimeComponent"]};for(var i in b.system().schemas()[e])switch(!0){case"property"===b.system().schemas()[e][i]:f[i]={type:"string",readOnly:!1,mandatory:!1,"default":""};break;case"link"===b.system().schemas()[e][i]:f[i]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,"default":{}};break;case"method"===b.system().schemas()[e][i]:f[i]={params:[{name:"param",type:"string",mandatory:!1}],result:"string"};break;case"event"===b.system().schemas()[e][i]:f[i]={params:[{name:"param",type:"string",mandatory:!1}]};break;case"collection"===b.system().schemas()[e][i]:f[i]={type:["string"],readOnly:!1,mandatory:!1,"default":[]}}b.system().models()[d]=f,g=this.require("ModelClass"),h=new g({title:c}),h.document(JSON.parse(JSON.stringify(f))),h.content(JSON.stringify(f)),b.save(),this.require("channel").createModel(c,f),this.hide(),b.space(c),b.spaces().render(),b.workspace().refresh(),this.require("message").success("model generated from the schema. You can now edit it, create behaviors or components from this model.")}}));break;case"types":g&&Object.keys(g).length&&(e=this.require("DialogTypeCreation"),f=new e({title:"Create a new type"}),f.show(),f.on("ok",function(){var a=this.require("designer"),b=null,c=!1,d={},e=null,f=null;b=$("#designer-dialog-type-creation-name").val(),c=$("#designer-dialog-type-creation-isEnum")[0].checked,b=b.trim(),b=b.replace(/ /gi,"_"),b&&(d=c?{name:b,type:"string",value:[""]}:{name:b,type:"object",schema:{}},a.system().types()[b]=d,e=this.require("ModelType"),f=new e({title:b}),f.uuid=b,f.document(JSON.parse(JSON.stringify(d))),f.content(JSON.stringify(d)),a.save(),this.require("channel").createType(b,d),this.hide(),a.space(b),a.spaces().render(),a.workspace().refresh(),this.require("message").success("type created. You can use it in your model."))}));break;case"components":if(g&&Object.keys(g).length){var h=this.require("designer"),i=(h.system().schemas(),h.system().models()),j={},k=null,l=null,m="",n="",o="",p=null;if(m=a(h.space()),n=h.space(),p=b(n),Object.keys(p)){o=c(),j={_id:o};var q=[];for(var r in p)"property"===p[r]&&q.push(r),"link"===p[r]&&q.push(r),"collection"===p[r]&&q.push(r);q.sort(),length=q.length;for(var s=0;s<length;s++)j[q[s]]=i[m][q[s]]["default"];h.system().components()[n]||(h.system().components()[n]={}),h.system().components()[n][o]=j,k=this.require("ModelComponent"),l=new k({title:o}),l.model(n),l.uuid(o.toString()),l.document(JSON.parse(JSON.stringify(j))),l.content(JSON.stringify(j)),l.render(),$("#designer-component-"+o.toString()).hide(),$("#designer-component-"+o.toString()).fadeIn(1e3),h.save(),this.require("channel").createComponent(m,j)}}break;case"behaviors":g&&Object.keys(g).length&&(e=this.require("DialogBehaviorCreation"),f=new e({title:"Create a new behavior"}),f.show(),f.on("ok",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}function b(a){var b="",c="";for(c in d.system().schemas())if(d.system().schemas()[c]._name===a){b=c;break}return b}function c(a){var b="",c="";for(c in d.system().models())if(d.system().models()[c]._name===a){b=c;break}return b}var d=this.require("designer"),e=d.system().schemas(),f=d.system().models(),g="",h="",i=null,j={},k="",l="",m=null,n=null,o="",p="",q="",r="",s=0,t=0;if(o=d.space(),p=$("#designer-dialog-behavior-creation-state").val(),o&&p){if(q=a(),o!==d.system().name()){if(g=b(o),h=c(o),f[h][p]&&(i=f[h][p].params),i&&i.length)for(t=i.length,s=0;t>s;s++)r=0===s?i[s].name:r+", "+i[s].name;if("property"!==e[g][p]&&"link"!==e[g][p]||(r="value"),"collection"===e[g][p]&&(r="size, value, event"),"init"===p&&(r="conf"),f[h][p]&&(k=f[h][p].result),k)switch(k){case"string":l="	var result = '';\n	return result;\n";break;case"array":l="	var result = [];\n	return result;\n";break;case"number":l="	var result = 0;\n	return result;\n";break;case"object":l="	var result = {};\n	return result;\n";break;default:l="	var result = {};\n	return result;\n"}}else o=d.system().id();j={_id:q,component:o,state:p,action:"function "+p+"("+r+") {\n"+l+"}",useCoreAPI:!1,core:!1},d.system().behaviors()[q]=j,m=this.require("ModelBehavior"),n=new m({uuid:q}),n.title(p),n.content(JSON.parse(JSON.stringify(j.action))),this.hide(),n.render(),Prism.highlightAll(),$("#designer-behavior-"+q.toString()).hide(),$("#designer-behavior-"+q.toString()).fadeIn(1e3),d.save(),this.require("channel").createBehavior(j)}}))}}),B.on("refresh",function(){function a(a){var b="",c="";for(c in p.schemas())if("name"===p.schemas()[c]._name){b=c;break}return b}var b=null,c=null,d=null,e=null,f=null,g="",h="",i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=this.designer().system(),q=this.designer().space(),r="",s=[],t=null,u=0;if(p){switch(this.clear(),this.designer().context()){case"system":var v=JSON.parse(window.localStorage.getItem("systems")),w=[],x=0;for(v&&(w=v.systems),u=w.length,x=0;u>x;x++)p=JSON.parse(window.localStorage.getItem(w[x])),p.name===q&&(b=this.require("ModelSystem"),f=new b({title:p.name}),f.uuid(p._id),f.document(JSON.parse(JSON.stringify(p))),f.content(JSON.stringify(p)),f.render());break;case"schemas":if(q)for(h in p.schemas())if(p.schemas()[h]._id===q){for(c=this.require("ModelSchema"),t=p.schemas()[h]._inherit,u=0,t&&(u=t.length),x=0;u>x;x++){if(r=a(t[x]),e=new c({title:t[x]}),"RuntimeComponent"===t[x]){r="111df11e2b19fde";var y={_id:"RuntimeComponent",_name:"RuntimeComponent",_core:!0,classInfo:"property",on:"method",off:"method",require:"method",destroy:"method",init:"method",error:"event"};e.document(y),e.content(JSON.stringify(y))}else e.document(JSON.parse(JSON.stringify(p.schemas()[r]))),e.content(JSON.stringify(p.schemas()[r]));s.push(r),e.uuid(r),e.render()}for(e=new c({title:p.schemas()[h]._name}),e.uuid(h),e.document(JSON.parse(JSON.stringify(p.schemas()[h]))),e.content(JSON.stringify(p.schemas()[h])),e.render(),x=0;u>x;x++)this.designer().linkModel(h,s[x])}break;case"models":if(q)for(h in p.models())if(p.models()[h]._id===q){for(d=this.require("ModelClass"),t=p.models()[h]._inherit,u=0,t&&(u=t.length),x=0;u>x;x++){if(r=a(t[x]),i=new d({title:t[x]}),"RuntimeComponent"===t[x]){r="123751cb591de26";var z={_name:"RuntimeComponent",_schema:"RuntimeComponent",_core:!0,on:{params:[{name:"state",type:"string"},{name:"handler",type:"function"},{name:"useCoreAPI",type:"boolean",mandatory:!1}]},off:{params:[{name:"state",type:"string"},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}]},destroy:{params:[]},classInfo:{type:"@RuntimeClassInfo",readOnly:!1,mandatory:!1,"default":{}},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]}};i.document(z),i.content(JSON.stringify(z))}else i.document(JSON.parse(JSON.stringify(p.models()[r]))),i.content(JSON.stringify(p.models()[r]));s.push(r),i.uuid(r),i.render()}for(i=new d({title:p.models()[h]._name}),i.uuid(h),i.document(JSON.parse(JSON.stringify(p.models()[h]))),i.content(JSON.stringify(p.models()[h])),i.render(),x=0;u>x;x++)this.designer().linkModel(h,s[x])}break;case"types":if(q)for(g in p.types())p.types()[g].name===q&&(j=this.require("ModelType"),k=new j({title:g}),k.uuid(g),k.document(JSON.parse(JSON.stringify(p.types()[q]))),k.content(JSON.stringify(p.types()[q])),k.render());break;case"components":if(q)if(this.require("designer").state().component())g=this.require("designer").state().component(),p.components()[q][g]&&(l=this.require("ModelComponent"),m=new l({title:g}),m.uuid(g),m.model(q),m.document(JSON.parse(JSON.stringify(p.components()[q][g]))),m.content(JSON.stringify(p.components()[q][g])),m.render());else for(g in p.components()[q])l=this.require("ModelComponent"),m=new l({title:g}),m.uuid(g),m.model(q),m.document(JSON.parse(JSON.stringify(p.components()[q][g]))),m.content(JSON.stringify(p.components()[q][g])),m.render();break;case"behaviors":if(q){g=this.require("designer").state().component();for(h in p.behaviors())p.behaviors()[h].component===q&&(g&&p.behaviors()[h].state===g||""===g)&&(n=this.require("ModelBehavior"),o=new n({uuid:p.behaviors()[h]._id}),o.title(p.behaviors()[h].state),o.content(JSON.parse(JSON.stringify(p.behaviors()[h].action))),o.render()),q===this.require("designer").system().name()&&p.behaviors()[h].component===this.require("designer").system().id()&&(n=this.require("ModelBehavior"),o=new n({uuid:p.behaviors()[h]._id}),o.title(p.behaviors()[h].state),o.content(JSON.parse(JSON.stringify(p.behaviors()[h].action))),o.render());Prism.highlightAll()}}this.designer().filter()&&this.designer().filter(this.designer().filter())}}),B.on("clear",function(){$("#designer-workspace").empty(),jsPlumb.deleteEveryEndpoint()});var C=this.require("Server");C.on("start",function(){var a=null,b=null,c=null,d=null;a=this.require("RuntimeChannel"),b=new a({_id:"channel"}),b.on("send",function(a){this.require("worker").worker().port.postMessage(a)}),b.on("getSystem",function(a){var b=null;a===this.require("designer").system().id()?(b=this.require("db").collections().System.find({_id:a})[0],b=JSON.parse(JSON.stringify(b)),delete b.classInfo,this.setSystem(a,b)):this.setSystem(a,JSON.parse(window.localStorage.getItem(a)))}),b.on("getInitSystem",function(a){var b=null;a===this.require("designer").system().id()?(b=this.require("db").collections().System.find({_id:a})[0],b=JSON.parse(JSON.stringify(b)),delete b.classInfo,this.setInitSystem(a,b)):this.setInitSystem(a,JSON.parse(window.localStorage.getItem(a)))}),b.on("getType",function(a){this.setType(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].types[a])}),b.on("getSchema",function(a){this.setSchema(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].schemas[a])}),b.on("getModel",function(a){this.setModel(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].models[a])}),b.on("getBehavior",function(a){this.setBehavior(a,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].behaviors[a])}),b.on("getComponent",function(a,b){function c(a){var b="",c="";for(c in e.system().models())if(e.system().models()[c]._name===a){b=c;break}return b}var d="",e=this.require("designer");d=c(b),this.setComponent(a,b,this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].components[b][a],this.require("db").collections().System.find({_id:this.require("designer").system().id()})[0].models[d])}),b.on("updateType",function(a,b){var c=this.require("designer");c.system().types()[a]=b,c.save(),c.space(b.name),c.spaces().render(),c.workspace().refresh()}),b.on("deleteType",function(a){var b=this.require("designer"),c=[],d=null;c=this.require("db").collections().ModelType.find({uuid:a}),c.length&&(d=this.require(c[0]._id),d&&(d.hide(),d.destroy())),delete b.system().types()[a],b.save(),b.workspace().refresh()}),b.on("updateSchema",function(a,b){var c=this.require("designer");jsPlumb.deleteEveryEndpoint(),c.syncModel(b),c.system().schemas()[a]=b,c.save(),c.space(a),c.spaces().render(),c.workspace().refresh()}),b.on("deleteSchema",function(a){var b=this.require("designer"),c=[],d=null;c=this.require("db").collections().ModelSchema.find({uuid:a}),c.length&&(d=this.require(c[0]._id),d&&(d.hide(),d.destroy())),delete b.system().schemas()[a],b.save(),b.workspace().refresh()}),b.on("updateModel",function(a,b){var c=this.require("designer");jsPlumb.deleteEveryEndpoint(),c.system().models()[a]=b,c.save(),c.space(a),c.spaces().render(),c.workspace().refresh()}),b.on("deleteModel",function(a){var b=this.require("designer"),c=[],d=null;c=this.require("db").collections().ModelClass.find({uuid:a}),c.length&&(d=this.require(c[0]._id),d&&(d.hide(),d.destroy())),delete b.system().models()[a],b.save(),b.workspace().refresh()}),b.on("updateBehavior",function(a,b){var c=this.require("designer");c.system().behaviors()[a]=b,c.save(),c.workspace().refresh()}),b.on("deleteBehavior",function(a){var b=this.require("designer"),c=[],d=null;c=this.require("db").collections().ModelBehavior.find({uuid:a}),c.length&&(d=this.require(c[0]._id),d&&(d.hide(),d.destroy())),delete b.system().behaviors()[a],b.save(),b.workspace().refresh()}),b.on("updateComponent",function(a,b,c){var d=this.require("designer");d.system().components()[b][a]=c,d.save(),d.workspace().refresh()}),b.on("deleteComponent",function(a,b){var c=this.require("designer"),d=[],e=null;d=this.require("db").collections().ModelComponent.find({uuid:a}),d.length&&(e=this.require(d[0]._id),e&&(e.hide(),e.destroy())),delete c.system().components()[b][a],c.save(),c.workspace().refresh()}),b.on("updateSystem",function(a,b){var c=this.require("System"),d=null,e=this.require("designer");e.system()&&e.system().destroy(),d=new c(b),e.system(d),e.save(),e.space(b.name),e.spaces().render(),e.workspace().refresh()}),b.on("loadSystem",function(a){var b=null,c=null;b=this.require("DialogImport"),c=new b({title:"A system has been found",message:"Do you want to import the system ?",data:a}),c.show(),c.on("ok",function(){var a=this.require("System"),b=null,c=this.require("designer"),d=this.require("message");c.system()&&c.system().destroy(),b=new a(this.data()),c.system(b),c.save(),c.space(b.name()),c.spaces().render(),c.workspace().refresh(),this.hide(),c.save(),d.success("importation of the system is done.")})}),b.on("updateBehavior",function(a,b){var c=this.require("designer");c.debug()&&this.require(a).action(b.action)}),b.on("sync",function(){var a=null,b=null,c=this.require("designer");c.debug()&&(b=this.require("db").system(),c.system()&&c.system().destroy(),a=this.require("System"),c.system(new a(JSON.parse(b))),c.save(),c.space(c.system().name()),c.spaces().render(),c.workspace().refresh())}),c=this.require("Worker"),d=new c({_id:"worker",worker:new SharedWorker("./scripts/worker.js")}),d.worker().port.onmessage=function(a){$db.RuntimeMessage.insert(a.data)}},!0);var D=this.require("Designer");D.on("init",function(a){var b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m="",n=null,o=null;b=this.require("MenuBar"),c=new b({designer:this}),d=this.require("ToolBar"),e=new d({designer:this}),f=this.require("Workspace"),g=new f({designer:this}),j=this.require("Spaces"),k=new j({designer:this}),n=this.require("Server"),o=new n({designer:this}),this.menubar(c),this.toolbar(e),this.workspace(g),this.spaces(k),this.server(o),this.require("logger").on("warn",function(a){this.require("message").warning(a)}),this.require("logger").on("error",function(a){this.require("message").danger(a)}),h=this.require("DesignerState"),i=new h,this.state(i),l=this.require("System");var p=JSON.parse(window.localStorage.getItem("systems"));switch(!0){case"string"==typeof document.location.search.split("?")[1]:var q=JSON.parse(decodeURI(document.location.search.split("?")[1].split("system=")[1])),r=null;r=new l(q),this.system(r),this.save(),this.refresh(),this.require("message").success("the system '"+q.name+"' was imported");break;case window.location.href.split("#").length>1&&window.location.href.split("#")[1].length>0:m=window.location.href.split("#")[1],window.localStorage.getItem(m)&&(this.system(new l(JSON.parse(window.localStorage.getItem(m)))),this.refresh());break;default:p&&p.systems&&p.systems.length&&p.systems[0].length&&this.system(new l(JSON.parse(window.localStorage.getItem(p.systems[0])))),this.refresh()}this.check(),this.welcome();var s=this;window.onhashchange=function(a){var b=window.location.href.split("#"),c="",d="system",e="",f=0,g=0,h=null,i=null;for(b.length>1&&(c=b[1]),b.length>2&&(d=b[2]),b.length>3&&(e=b[3]),b.length>4?s.state().component(b[4]):s.state().component(""),b.length>1&&c?s.system(new l(JSON.parse(window.localStorage.getItem(c)))):p&&p.systems&&p.systems.length&&s.system(new l(JSON.parse(window.localStorage.getItem(p.systems[0])))),s.space(e),s.context(d),i=document.getElementById("designer-menubar-items"),g=s.menubar().items().length,f=0;g>f;f++)h=i.children[f],$(h).removeClass("active");for(f=0;g>f;f++)s.menubar().items(f).name()===d&&(h=i.children[f],$(h).addClass("active"));s.updateRouter()},$(window).resize(function(){jsPlumb.repaintEverything()})}),D.on("check",function(){var a=null,b=null;"undefined"==typeof SharedWorker&&(a=this.require("DialogCheck"),b=new a({title:"Hem... You will laugh",message:"Your browser has not all the features to use correctly System Designer.<br><br>Please use:<br><br>- Mozilla Firefox (recommended) or <br>- Google Chrome (desktop only).<br><br>"}),b.show())}),D.on("welcome",function(){var a=null,b=null;"undefined"!=typeof SharedWorker&&-1===document.cookie.indexOf("sysDesWelcome=true")&&(a=this.require("DialogWelcome"),b=new a({title:"Welcome to System Designer"}),b.show(),b.on("ok",function(){document.cookie="sysDesWelcome=true",this.hide()}))}),D.on("render",function(){this.menubar().render(),this.toolbar().render(),this.spaces().render()}),D.on("filter",function(a){var b=[],c="";switch(this.context()){case"behaviors":c="ModelBehavior";break;case"schemas":c="ModelSchema";break;case"types":c="ModelType";break;case"models":c="ModelClass";break;case"components":c="ModelComponent";break;case"system":c="ModelSystem"}for(var d=this.require("db").collections()[c].find({}),e=0;e<d.length;e++)b.push(this.require(d[e]._id));switch(a.length>0?b.forEach(function(b){-1===b.content().toLowerCase().indexOf(a.toLowerCase())?b.hide():b.show()}):b.forEach(function(a){a.show()}),this.context()){case"schemas":case"models":jsPlumb.repaintEverything()}}),D.on("context",function(a){jsPlumb.deleteEveryEndpoint(),this.spaces().render(),this.workspace().clear(),this.workspace().refresh()}),D.on("space",function(a){"system"===this.context()&&this.updateRouter()}),D.on("updateRouter",function(){var a=[],b=0,c=0,d="",e="";if(this.require("designer").system())for(a=$("#designer-menubar-items > li > a"),c=a.length,b=0;c>b;b++)e=a[b].href,d=e.split("#")[e.split("#").length-1],a[b].href="#"+this.require("designer").system().id()+"#"+d;else for(a=$("#designer-menubar-items > li > a"),c=a.length,b=0;c>b;b++)e=a[b].href,d=e.split("#")[e.split("#").length-1],a[b].href="##"+d}),D.on("createBehavior",function(a,b,c){function d(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var e="";if(uuid=d(),methodDef=c.params,methodDef&&methodDef.length)for(length=methodDef.length,i=0;i<length;i++)0===i?params=methodDef[i].name:params=params+", "+methodDef[i].name;if(result=c.result,result)switch(result){case"string":e="	var result = '';\n	return result;\n";break;case"array":e="	var result = [];\n	return result;\n";break;case"number":e="	var result = 0;\n	return result;\n";break;case"object":e="	var result = {};\n	return result;\n";break;default:e="	var result = {};\n	return result;\n"}behavior={_id:uuid,component:a,state:b,action:"function "+b+"("+params+") {\n"+e+"}",useCoreAPI:!1,core:!1},this.system().behaviors()[uuid]=behavior,this.save()}),D.on("deleteSchema",function(a){function b(a,b){var c="",d="";for(d in b)if(b[d]._name===a){c=d;break}return c}var c="",d="",e=null,f=this.system().models(),g=this.system().schemas(),h=g[a]._name;delete this.system().components()[h];for(c in this.system().behaviors())e=this.system().behaviors()[c],e.component===h&&delete this.system().behaviors()[c];d=b(g[a]._name,f),d&&delete this.system().models()[d],delete g[a]}),D.on("createModel",function(a){function b(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a();
}var c=(this.system().schemas(),this.system().models()),d="",e="",f="",g=null,h=null;e=b(),h={_id:e,_name:a._name,_schema:a._name,_inherit:["RuntimeComponent"]};for(f in a)if(0!==f.indexOf("_"))switch(!0){case"property"===a[f]:h[f]={type:"string",readOnly:!1,mandatory:!1,"default":""};for(g in this.system().components()[d])this.system().components()[d][g][f]=h[f]["default"];break;case"link"===a[f]:h[f]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,"default":{}};for(g in this.system().components()[d])this.system().components()[d][g][f]=h[f]["default"];break;case"method"===a[f]:h[f]={params:[{name:"param",type:"string",mandatory:!1}],result:"string"};for(g in this.system().components()[d])this.system().components()[d][g][f]=h[f]["default"];break;case"event"===a[f]:h[f]={params:[{name:"param",type:"string",mandatory:!1}]};for(g in this.system().components()[d])this.system().components()[d][g][f]=h[f]["default"];break;case"collection"===a[f]:h[f]={type:["string"],readOnly:!1,mandatory:!1,"default":[]};for(g in this.system().components()[d])this.system().components()[d][g][f]=h[f]["default"]}c[e]=h,this.save()}),D.on("syncModel",function(a){var b=this.system().schemas(),c=this.system().models(),d="",e="",f="",g=null,h=null,i=null,j=null;for(e in c)"undefined"!=typeof c[e]._schema&&c[e]._schema===a._name&&(i=c[e]);j=b[a._id];for(f in a)if(a.hasOwnProperty(f)&&0!==f.indexOf("_")&&("undefined"==typeof j[f]||j[f]!==a[f]))switch(!0){case"property"===a[f]:i[f]={type:"any",readOnly:!1,mandatory:!1,"default":null};for(g in this.system().components()[d])this.system().components()[d][g][f]=i[f]["default"];break;case"link"===a[f]:i[f]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,"default":{}};for(g in this.system().components()[d])this.system().components()[d][g][f]=i[f]["default"];break;case"method"===a[f]:i[f]={params:[{name:"param",type:"string",mandatory:!1}],result:"string"};for(g in this.system().components()[d])this.system().components()[d][g][f]=i[f]["default"];this.createBehavior(c[e]._name,f,i[f]);break;case"event"===a[f]:i[f]={params:[{name:"param",type:"string",mandatory:!1}]};for(g in this.system().components()[d])this.system().components()[d][g][f]=i[f]["default"];this.createBehavior(c[e]._name,f,i[f]);break;case"collection"===a[f]:i[f]={type:["@RuntimeComponent"],readOnly:!1,mandatory:!1,"default":[]};for(g in this.system().components()[d])this.system().components()[d][g][f]=i[f]["default"]}for(f in j)if(0!==f.indexOf("_")&&"undefined"==typeof a[f]){delete i[f];for(g in this.system().components()[d])delete this.system().components()[d][g][f];for(h in this.system().behaviors())i&&this.system().behaviors()[h].component===i._name&&this.system().behaviors()[h].state===f&&delete this.system().behaviors()[h]}}),D.on("linkModel",function(a,b){jsPlumb.setContainer("body"),jsPlumb.connect({paintStyle:{strokeStyle:"#7F949D",lineWidth:3},source:"designer-model-panel-"+a,target:"designer-model-panel-"+b,overlays:[["Arrow",{location:1}]]},{connector:["Flowchart"],anchor:["Left","Right"],endpoint:"Blank"})}),D.on("save",function(){var a=JSON.parse(window.localStorage.getItem("systems")),b=this.require("designer"),c=this.require("db").collections().System.find({_id:b.system().id()})[0],d=c._id;window.localStorage.setItem(d,JSON.stringify(c)),a?-1===a.systems.indexOf(d)&&a.systems.push(d):a={systems:[d]},window.localStorage.setItem("systems",JSON.stringify(a))}),a.on("main",function(){var a=null,b=null;a=this.require("Designer"),b=new a({_id:"designer"}),b.render(),b.server().start()}),a.main()});