<!DOCTYPE html>
<html>

<head>
    <title>app</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="systems/app.json" type="application/json" rel="system">
</head>

<body>
    <!-- Runtime -->
    <script type="text/javascript" level="error" src="lib/system-runtime/system-runtime.min.js"></script>
    <script>
        runtime.on('ready', function () {
            var system = runtime.system('app');
            system.on('main', function () {
                var channel = null,
                    sysid = ''; 
                
                // start admin    
                this.require('admin').start('./');  
                              
                channel = this.require('channel-admin');
                
                // channel event
                channel.on('setInitSystem', function (id, system) {
                    delete system.classInfo;
                    var messages = [];                                       
                    
                    this.require('logger').info('loading the system...');
                    var systemID = this.require('db').system(system);                  
                    this.require('logger').info('the system is loaded');
                    
                    this.require('logger').on('debug', function (message) {
                        var date = new Date(),
                        time = date.toLocaleTimeString();
                        
                        this.require('channel-admin').logDebug('[' + time + '] ' + message);    
                    }); 
                    
                    this.require('logger').on('info', function (message) {
                        var date = new Date(),
                        time = date.toLocaleTimeString();
                        
                        this.require('channel-admin').logInfo('[' + time + '] ' + message);    
                    });
                    
                    this.require('logger').on('warn', function (message) {
                        var date = new Date(),
                        time = date.toLocaleTimeString();
                        
                        this.require('channel-admin').logWarn('[' + time + '] ' + message);    
                    });  
                    
                    this.require('logger').on('error', function (message) {
                        var date = new Date(),
                        time = date.toLocaleTimeString();
                        
                        this.require('channel-admin').logError('[' + time + '] ' + message);    
                    });     

                    this.require('logger').level('debug');
                    this.require(systemID).main();
                });
                
                sysid = document.location.search.split('?')[1].split('id=')[1];
                channel.getInitSystem(sysid);
                
                channel.off('sync');
            }, true);
            
            system.main();
        });
    </script>
</body>

</html>