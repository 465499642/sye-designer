<!DOCTYPE html>
<html>

<head>
    <title>App</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="systems/app.json" type="application/json" rel="system">
</head>

<body>
    <!-- Runtime -->
    <script type="text/javascript"src="lib/system-runtime/system-runtime.min.js"></script>
    <script>
        runtime.on('ready', function () {
            var system = runtime.system('app');
            system.on('main', function () {
                var channel = null,
                    sysid = ''; 
                
                // start admin    
                this.require('admin').start('./');  
                              
                channel = this.require('channel-admin');
                
                // channel event
                channel.on('setInitSystem', function (id, system) {
                    delete system.classInfo;
                    var systemID = this.require('db').system(system);

                    this.require('logger').info('the system is loaded')

                    this.require(systemID).main();
                });

                sysid = document.location.search.split('?')[1].split('id=')[1];
                channel.getInitSystem(sysid);
                
                channel.off('sync');
                
                this.require('logger').level('info');
                this.require('logger').info('loading the system...');
            }, true);
            
            system.main();
        });
    </script>
</body>

</html>