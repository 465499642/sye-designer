{
  "name": "designer-runtime",
  "master": false,
  "subsystem": false,
  "version": "1.0.0",
  "description": "System Designer Runtime",
  "schemas": {
    "1268f1dddd1fea7": {
      "_name": "_Logger",
      "_core": true,
      "level": "property",
      "debug": "method",
      "info": "method",
      "warn": "method",
      "error": "method",
      "_id": "1268f1dddd1fea7"
    },
    "104ad1f48518376": {
      "_id": "104ad1f48518376",
      "_name": "_Channel",
      "_core": true,
      "$editorUpdateSystem": "event",
      "$editorUpdateSchema": "event",
      "$editorUpdateSchemaId": "event",
      "$editorUpdateSchemaName": "event",
      "$editorUpdateModel": "event",
      "$editorUpdateModelId": "event",
      "$editorUpdateType": "event",
      "$editorDeleteType": "event",
      "$editorUpdateBehavior": "event",
      "$editorDeleteBehavior": "event",
      "$editorUpdateComponent": "event",
      "$editorDeleteComponent": "event",
      "$appLogDebug": "event",
      "$appLogInfo": "event",
      "$appLogWarn": "event",
      "$appLogError": "event",
      "$appLoadSystem": "event",
      "$designerSync": "event",
      "$designerCreateBehavior": "event",
      "$designerCreateComponent": "event",
      "$designerCreateType": "event",
      "$designerCreateSchema": "event",
      "$designerCreateModel": "event",
      "$designerDeleteSchema": "event",
      "$designerDeleteModel": "event",
      "$designerDeleteType": "event",
      "$designerDeleteBehavior": "event",
      "$designerDeleteComponent": "event",
      "$designerUpdateComponent": "event",
      "$designerUpdateModel": "event",
      "$designerUpdateBehavior": "event",
      "$runtimeCreateComponent": "event",
      "$runtimeDeleteComponent": "event",
      "$runtimeUpdateComponent": "event",
      "_inherit": ["_Component"],
      "send": "event"
    }
  },
  "behaviors": {
    "f1c9d810bdf16d0f": {
      "_id": "f1c9d810bdf16d0f",
      "component": "16d0e138c8170b2",
      "state": "start",
      "action": "function start() { \n  var sysid = '',\n    system = '',\n    params = '',\n    systemID = '';\n            \n  if (typeof global !== 'undefined' && typeof window === 'undefined') {\n    global.require = require;\n  }\n\n  window.messages = []; // TODO find better way\n  window.lastPage = 'index.html'; // TODO find better way\n  \n  function _getParams() {\n    var result = {},\n        urlParams = [],\n        system = null;\n\n    urlParams = document.location.href.split('?');\n\n    if (urlParams.length > 1) {\n      urlParams = urlParams[1].split('&');\n      urlParams.forEach(function (urlParam) {\n        var name = '',\n            value = '';\n\n        name = urlParam.split('=')[0].trim();\n        value = urlParam.split('=')[1].trim();\n\n        result[name] = decodeURIComponent(value);\n      });\n    }\n    return result;\n  }\n\n  // case of cordova    \n  if (typeof cordova !== 'undefined') {\n    params = _getParams();\n    system = null;\n\n    if (Object.keys(params).length) {\n      system = JSON.parse(params.system);\n      this.require('storage').set(system._id, system);\n      lastPage = params.ref;\n    }\n\n    // add back button\n    setTimeout(function () {\n      if (!document.getElementById('system-designer-back')) {\n        var docFragment = null,\n            div = null,\n            a = null,\n            span = null;\n\n        docFragment = document.createDocumentFragment();\n        div = document.createElement('div');\n        div.setAttribute('id', 'system-designer-back');\n        div.setAttribute('style', 'top:5px;left:10px;position:absolute;font-size:18px;font-family:Helvetica,Arial,sans-serif;z-index:999999;background-color:white;');\n\n        a = document.createElement('a');\n        /* jshint -W107 */\n        a.setAttribute('href', 'javascript:systemDesignerBack()');\n        /* jshint +W107 */\n        a.setAttribute('style', 'text-decoration:none; color:#337AB7;');\n\n        span = document.createElement('span');\n        span.setAttribute('style', \"font-family: 'Helvetica Neue';\");\n        span.textContent = ' < System Designer';\n\n        a.appendChild(span);\n        div.appendChild(a);\n        docFragment.appendChild(div);\n\n        document.body.appendChild(docFragment);\n      }\n    }, 1000);\n  }\n\n  // get system\n  sysid = document.location.href.split('#')[1].split('?')[0].split('/')[0];\n  system = this.require('storage').get(sysid);\n  delete system.classInfo;\n  \n  this.require('storage').on('changed', function (obj) {\n    if (typeof obj['system-designer-message'] !== 'undefined') {\n      $db._Message.insert(obj['system-designer-message'].newValue);\n    }\n  }, true, true);\n  \n  this.require('logger').info('loading the system...');\n  systemID = $db.importSystem(system);\n  this.require('logger').info('the system is loaded');\n\n  document.title = system.name;\n  \n  this.require('logger').level('debug');\n  if (this.require(systemID).start) {\n    this.require(systemID).start();\n  }\n}",
      "useCoreAPI": true,
      "core": true
    },
    "c165d41881d11694": {
      "_id": "c165d41881d11694",
      "component": "channel",
      "state": "send",
      "action": "function send(message) { \n  var designer = this.require('designer'),\n      checkStringify = null;\n\n  if (typeof cordova !== 'undefined') {\n    messages.push(message);\n  }\n  try {\n    // test\n    checkStringify = JSON.stringify(message);\n    \n    this.require('storage').set('system-designer-message', message);\n  } catch (e) {\n  }\t\n}",
      "useCoreAPI": false,
      "core": true
    },
    "i139a61d4aa1bea7": {
      "_id": "i139a61d4aa1bea7",
      "component": "logger",
      "state": "info",
      "action": "function info(message) { \n  if (this.level() === 'info' || this.level() === 'debug') {\n    this.require('channel').$appLogInfo('[info] ' + message);\n  }\t\n}",
      "useCoreAPI": false,
      "core": true
    },
    "r1c1841a98e1bc15": {
      "_id": "r1c1841a98e1bc15",
      "component": "logger",
      "state": "debug",
      "action": "function debug(message) { \n  if (this.level() === 'debug') {\n    this.require('channel').$appLogDebug('[debug] ' + message);\n  }\t\n}",
      "useCoreAPI": false,
      "core": true
    },
    "m1d30414ed912a2a": {
      "_id": "m1d30414ed912a2a",
      "component": "logger",
      "state": "error",
      "action": "function error(message) { \n  this.require('channel').$appLogError('[error] ' + message);\n}",
      "useCoreAPI": false,
      "core": true
    },
    "d1d19f1ae9a12118": {
      "_id": "d1d19f1ae9a12118",
      "component": "logger",
      "state": "warn",
      "action": "function warn(message) { \n  if (this.level() === 'info' || this.level() === 'warn' || this.level() === 'debug') {\n    this.require('channel').$appLogWarn('[warn] ' + message);\n  }\n}",
      "useCoreAPI": false,
      "core": true
    }
  },
  "types": {
    "dbUpdateEvent": {
      "_id": "1f5c41309711752",
      "core": true,
      "name": "dbUpdateEvent",
      "type": "object",
      "schema": {
        "collection": {
          "type": "string",
          "mandatory": true,
          "default": ""
        },
        "id": {
          "type": "string",
          "mandatory": true,
          "default": ""
        },
        "field": {
          "type": "string",
          "mandatory": true,
          "default": ""
        },
        "value": {
          "type": "any",
          "mandatory": true,
          "default": null
        }
      }
    },
    "dbRemoveEvent": {
      "_id": "1952e1ac4213f4a",
      "core": true,
      "name": "dbRemoveEvent",
      "type": "object",
      "schema": {
        "collection": {
          "type": "string",
          "mandatory": true,
          "default": ""
        },
        "id": {
          "type": "string",
          "mandatory": true,
          "default": ""
        }
      }
    },
    "dbInsertEvent": {
      "_id": "148ef1e19810e6d",
      "core": true,
      "name": "dbInsertEvent",
      "type": "object",
      "schema": {
        "collection": {
          "type": "string",
          "mandatory": true,
          "default": ""
        },
        "document": {
          "type": "object",
          "mandatory": true,
          "default": {}
        }
      }
    },
    "message": {
      "name": "message",
      "type": "object",
      "schema": {
        "event": {
          "type": "string",
          "mandatory": true
        },
        "from": {
          "type": "string",
          "mandatory": false
        },
        "data": {
          "type": "object",
          "mandatory": true
        }
      },
      "core": true
    }
  },
  "components": {
    "_Channel": {
      "channel": {
        "_id": "channel",
        "_core": true
      }
    },
    "_Logger": {
      "logger": {
        "_id": "logger",
        "level": "warn"
      }
    }
  },
  "_id": "16d0e138c8170b2",
  "models": {
    "16b9d1ac2216ffe": {
      "_id": "16b9d1ac2216ffe",
      "_name": "_Logger",
      "_core": true,
      "level": {
        "type": "log",
        "readOnly": false,
        "mandatory": false,
        "default": "warn"
      },
      "debug": {
        "params": [{
          "name": "message",
          "type": "any"
        }]
      },
      "info": {
        "params": [{
          "name": "message",
          "type": "any"
        }]
      },
      "warn": {
        "params": [{
          "name": "message",
          "type": "any"
        }]
      },
      "error": {
        "params": [{
          "name": "message",
          "type": "any"
        }]
      }
    },
    "135c71078810af2": {
      "_id": "135c71078810af2",
      "_name": "_Channel",
      "_inherit": ["_Component"],
      "_core": true,
      "$editorUpdateSchemaName": {
        "params": [{
          "name": "name",
          "type": "string"
        }, {
          "name": "id",
          "type": "string"
        }]
      },
      "$designerSync": {},
      "$appLoadSystem": {
        "params": [{
          "name": "system",
          "type": "object"
        }]
      },
      "$designerCreateBehavior": {
        "params": [{
          "name": "behavior",
          "type": "object"
        }]
      },
      "$editorUpdateBehavior": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "behavior",
          "type": "object"
        }]
      },
      "$designerUpdateBehavior": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "behavior",
          "type": "object"
        }]
      },
      "$editorDeleteBehavior": {
        "params": [{
          "name": "id",
          "type": "string"
        }]
      },
      "$designerDeleteBehavior": {
        "params": [{
          "name": "id",
          "type": "string"
        }]
      },
      "$designerCreateComponent": {
        "params": [{
          "name": "collection",
          "type": "string"
        }, {
          "name": "component",
          "type": "object"
        }]
      },
      "$editorUpdateComponent": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "collection",
          "type": "string"
        }, {
          "name": "component",
          "type": "object"
        }]
      },
      "$designerUpdateComponent": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "collection",
          "type": "string"
        }, {
          "name": "component",
          "type": "object"
        }]
      },
      "$editorDeleteComponent": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "collection",
          "type": "string"
        }]
      },
      "$designerDeleteComponent": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "collection",
          "type": "string"
        }]
      },
      "$designerCreateType": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "type",
          "type": "object"
        }]
      },
      "$editorUpdateType": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "type",
          "type": "object"
        }]
      },
      "$editorDeleteType": {
        "params": [{
          "name": "id",
          "type": "string"
        }]
      },
      "$designerCreateSchema": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "schema",
          "type": "object"
        }]
      },
      "$editorUpdateSchema": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "schema",
          "type": "object"
        }]
      },
      "$editorUpdateSchemaId": {
        "params": [{
          "name": "oldId",
          "type": "string"
        }, {
          "name": "newId",
          "type": "string"
        }]
      },
      "$designerDeleteSchema": {
        "params": [{
          "name": "id",
          "type": "string"
        }]
      },
      "$designerCreateModel": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "model",
          "type": "object"
        }]
      },
      "$editorUpdateModel": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "model",
          "type": "object"
        }]
      },
      "$designerUpdateModel": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "model",
          "type": "object"
        }]
      },
      "$editorUpdateModelId": {
        "params": [{
          "name": "oldId",
          "type": "string"
        }, {
          "name": "newId",
          "type": "string"
        }]
      },
      "$designerDeleteModel": {
        "params": [{
          "name": "id",
          "type": "string"
        }]
      },
      "$editorUpdateSystem": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "system",
          "type": "object"
        }]
      },
      "$appLogDebug": {
        "params": [{
          "name": "message",
          "type": "string"
        }]
      },
      "$appLogInfo": {
        "params": [{
          "name": "message",
          "type": "string"
        }]
      },
      "$appLogWarn": {
        "params": [{
          "name": "message",
          "type": "string"
        }]
      },
      "$appLogError": {
        "params": [{
          "name": "message",
          "type": "string"
        }]
      },
      "$runtimeCreateComponent": {
        "params": [{
          "name": "collection",
          "type": "string"
        }, {
          "name": "component",
          "type": "object"
        }]
      },
      "$runtimeDeleteComponent": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "collection",
          "type": "string"
        }]
      },
      "$runtimeUpdateComponent": {
        "params": [{
          "name": "id",
          "type": "string"
        }, {
          "name": "collection",
          "type": "string"
        }, {
          "name": "field",
          "type": "string"
        }, {
          "name": "value",
          "type": "any"
        }]
      },
      "send": {
        "params": [{
          "name": "message",
          "type": "message"
        }]
      },
      "$systemInstalled": {
        "params": [{
          "name": "id",
          "type": "string",
          "mandatory": true,
          "default": ""
        }]
      },
      "$systemResolved": {
        "params": [{
          "name": "id",
          "type": "string",
          "mandatory": true,
          "default": ""
        }]
      },
      "$systemUninstalled": {
        "params": [{
          "name": "id",
          "type": "string",
          "mandatory": true,
          "default": ""
        }]
      },
      "$systemStarted": {
        "params": [{
          "name": "id",
          "type": "string",
          "mandatory": true,
          "default": ""
        }]
      },
      "$systemStopped": {
        "params": [{
          "name": "id",
          "type": "string",
          "mandatory": true,
          "default": ""
        }]
      }
    }
  }
}
