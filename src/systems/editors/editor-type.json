{"name":"editor-type","master":true,"subsystem":false,"version":"1.0.0","description":"","schemas":{"a1097d1ea0812005":{"_name":"MenuBar","designer":"property","logo":"property","header":"property","items":"collection","actions":"collection","render":"method","clear":"method","_id":"a1097d1ea0812005","_inherit":["RuntimeComponent"]},"f1257f17deb16097":{"_name":"ToolBar","designer":"property","items":"collection","render":"method","_id":"f1257f17deb16097","_inherit":["RuntimeComponent"]},"f1092816b571e03c":{"_name":"Workspace","designer":"property","create":"method","load":"method","clear":"method","refresh":"method","render":"method","_id":"f1092816b571e03c","_inherit":["RuntimeComponent"]},"k1b97018e111d0e3":{"_name":"Server","designer":"property","start":"method","_id":"k1b97018e111d0e3","_inherit":["RuntimeComponent"]},"o1ead8184af1a83e":{"_name":"Designer","_inherit":["RuntimeComponent"],"version":"property","menubar":"property","toolbar":"property","workspace":"property","spaces":"property","context":"property","oldContext":"property","space":"property","server":"property","system":"property","debug":"property","filter":"property","type":"property","store":"property","state":"property","runWindow":"property","debugWindow":"property","updateRouter":"method","syncModel":"method","syncBehavior":"method","syncComponent":"method","createModel":"method","createBehavior":"method","deleteSchema":"method","linkModel":"method","refresh":"method","save":"method","saveCordova":"method","saveAs":"method","clear":"method","check":"method","welcome":"method","generateId":"method","open":"method","render":"event","logs":"collection","isCordova":"method","isElectron":"method","updateCordovaContext":"method","messages":"property","runMessages":"method","lastPage":"property","getGeneratedSchema":"method","getGeneratedModel":"method","mergeBehavior":"method","_id":"o1ead8184af1a83e"}},"models":{"m120941f1811fd44":{"_id":"m120941f1811fd44","_name":"MenuBar","designer":{"type":"@Designer","readOnly":true,"mandatory":false,"default":{}},"logo":{"type":"@MenuLogo","readOnly":false,"mandatory":false,"default":{}},"header":{"type":"@MenuHeader","readOnly":false,"mandatory":false,"default":{}},"items":{"type":["@MenuItem"],"readOnly":false,"mandatory":false,"default":[]},"actions":{"type":["@MenuAction"],"readOnly":false,"mandatory":false,"default":[]},"render":{},"clear":{}},"g1b93a178ee14b48":{"_id":"g1b93a178ee14b48","_name":"ToolBar","designer":{"type":"@Designer","readOnly":true,"mandatory":true,"default":{}},"items":{"type":["@ToolBarItem"],"readOnly":false,"mandatory":false,"default":[]},"render":{}},"f109971f3711244f":{"_id":"f109971f3711244f","_name":"Workspace","designer":{"type":"@Designer","readOnly":true,"mandatory":true,"default":{}},"create":{},"load":{},"clear":{},"refresh":{},"render":{}},"m1cff61fc691bab2":{"_id":"m1cff61fc691bab2","_name":"Server","designer":{"type":"@Designer","readOnly":true,"mandatory":true,"default":{}},"start":{}},"l1b5e313e9a100af":{"_id":"l1b5e313e9a100af","_name":"Designer","version":{"type":"string","readOnly":false,"mandatory":false,"default":"2.0.0-alpha.1"},"menubar":{"type":"@MenuBar","readOnly":false,"mandatory":false,"default":{}},"toolbar":{"type":"@ToolBar","readOnly":false,"mandatory":false,"default":{}},"workspace":{"type":"@Workspace","readOnly":false,"mandatory":false,"default":{}},"spaces":{"type":"@Spaces","readOnly":false,"mandatory":false,"default":{}},"context":{"type":"string","readOnly":false,"mandatory":false,"default":""},"oldContext":{"type":"string","readOnly":false,"mandatory":false,"default":""},"space":{"type":"string","readOnly":false,"mandatory":false,"default":""},"server":{"type":"@Server","readOnly":false,"mandatory":false,"default":{}},"system":{"type":"@System","readOnly":false,"mandatory":false,"default":{}},"debug":{"type":"boolean","readOnly":false,"mandatory":false,"default":false},"filter":{"type":"string","readOnly":false,"mandatory":false,"default":""},"type":{"type":"editorType","readOnly":false,"mandatory":false,"default":"designer"},"store":{"type":"@Store","readOnly":false,"mandatory":false,"default":{}},"state":{"type":"@DesignerState","readOnly":false,"mandatory":false,"default":{}},"runWindow":{"type":"object","readOnly":false,"mandatory":false,"default":null},"debugWindow":{"type":"object","readOnly":false,"mandatory":false,"default":null},"updateRouter":{},"syncModel":{"params":[{"name":"schema","type":"object","mandatory":false,"default":{}}]},"syncBehavior":{"params":[{"name":"model","type":"object","mandatory":false,"default":{}}]},"syncComponent":{"params":[{"name":"model","type":"object","mandatory":false,"default":{}},{"name":"forceDelete","type":"boolean","mandatory":false,"default":true}]},"createModel":{"params":[{"name":"schema","type":"object","mandatory":false,"default":{}}]},"createBehavior":{"params":[{"name":"type","type":"string","mandatory":false,"default":"method"},{"name":"model","type":"string","mandatory":false,"default":""},{"name":"state","type":"string","mandatory":false,"default":""},{"name":"def","type":"object","mandatory":false,"default":{}}]},"deleteSchema":{"params":[{"name":"schemaId","type":"string","mandatory":false,"default":""}]},"linkModel":{"params":[{"name":"source","type":"string","mandatory":false,"default":""},{"name":"target","type":"string","mandatory":false,"default":""}]},"refresh":{},"save":{},"saveCordova":{},"saveAs":{"params":[{"name":"data","type":"object","mandatory":false,"default":{}},{"name":"fileName","type":"string","mandatory":false,"default":""}]},"clear":{},"check":{},"welcome":{},"generateId":{"result":"string"},"open":{"params":[{"name":"url","type":"string","mandatory":false,"default":""},{"name":"target","type":"string","mandatory":false,"default":""},{"name":"isExt","type":"boolean","mandatory":false,"default":false}]},"render":{},"logs":{"type":["@Log"],"readOnly":false,"mandatory":false,"default":[]},"isCordova":{"result":"boolean"},"isElectron":{"result":"boolean"},"updateCordovaContext":{},"messages":{"type":"array","readOnly":false,"mandatory":false,"default":[]},"runMessages":{"params":[{"name":"messages","type":"array","mandatory":true,"default":[]}]},"lastPage":{"type":"string","readOnly":false,"mandatory":false,"default":"index.html"},"getGeneratedSchema":{"params":[{"name":"schema","type":"string","mandatory":true,"default":""}],"result":"object"},"getGeneratedModel":{"params":[{"name":"model","type":"string","mandatory":true,"default":""}],"result":"object"},"mergeBehavior":{"params":[{"name":"behaviors","type":"object","mandatory":true,"default":{}},{"name":"behavior","type":"object","mandatory":true,"default":{}},{"name":"sysId","type":"string","mandatory":true,"default":""},{"name":"systemName","type":"string","mandatory":true,"default":""}]}}},"behaviors":{"x1ee3d18966173d2":{"_id":"x1ee3d18966173d2","component":"MenuBar","state":"init","action":"function init(conf) { \n  var menuHeader = [],\n    menuItems = [],\n    menuActions = [],\n    menuSearch = [],\n    self = this;\n\n  // menu header\n  menuHeader = this.require('db').collections().MenuHeader.find({\n    \"type\": this.designer().type()\n  });\n  this.header(this.require(menuHeader[0]._id));\n\n  // menu items\n  menuItems = this.require('db').collections().MenuItem.find({\n    \"type\": this.designer().type()\n  });\n\n  menuItems.sort(function (itemA, itemB) {\n    if (itemA.position > itemB.position) {\n      return 1;\n    }\n    if (itemA.position < itemB.position) {\n      return -1;\n    }\n    return 0;\n  });\n\n  menuItems.forEach(function (menuItem) {\n    var id = menuItem._id;\n    self.items().push(self.require(id));\n  });\n\n  // menu actions\n  menuActions = this.require('db').collections().MenuAction.find({\n    \"type\": this.designer().type()\n  });\n\n  menuSearch = this.require('db').collections().MenuSearch.find({\n    \"type\": this.designer().type()\n  });\n\n  menuActions = menuActions.concat(menuSearch);\n\n  menuActions.sort(function (itemA, itemB) {\n    if (itemA.position > itemB.position) {\n      return 1;\n    }\n    if (itemA.position < itemB.position) {\n      return -1;\n    }\n    return 0;\n  });\n\n  menuActions.forEach(function (menuAction) {\n    var id = menuAction._id;\n    self.actions().push(self.require(id));\n  });\n}","useCoreAPI":false,"core":false},"x134921a81e1d05b":{"_id":"x134921a81e1d05b","component":"MenuBar","state":"render","action":"function render() { \n  var length = 0,\n    i = 0,\n    item = null,\n    domHeader = document.getElementById('designer-menubar-header'),\n    domItems = document.getElementById('designer-menubar-items'),\n    domAction = document.getElementById('designer-menubar-actions'),\n    self = this;\n\n  function _removeActive() {\n    var length = 0,\n      i = 0,\n      item = null;\n\n    length = domItems.children.length;\n    for (i = 0; i < length; i++) {\n      item = domItems.children[i];\n      $(item).removeClass('active');\n    }\n  }\n\n  // header\n  domHeader.insertAdjacentHTML('afterbegin', this.header().html().source());\n\n  // items\n  this.items().forEach(function (item) {\n    domItems.insertAdjacentHTML('beforeend', '<li>' + item.html().source() + '</>');\n  });\n\n  // events\n  var callback = function () {\n    _removeActive();\n    $(this).addClass('active');\n  };\n  length = domItems.children.length;\n  for (i = 0; i < length; i++) {\n    item = domItems.children[i];\n    item.addEventListener('click', callback);\n    item.addEventListener('click', function () {\n      this.click();\n    }.bind(self.items(i)));\n  }\n\n  // actions\n  this.actions().forEach(function (action) {\n    domAction.insertAdjacentHTML('afterbegin', '<li>' + action.html().source() + '</>');\n  });\n\n  // focus on first element\n  if (length > 0) {\n    this.designer().context(this.items(0).name());\n    item = domItems.children[0];\n    $(item).addClass('active');\n  }\n}","useCoreAPI":false,"core":false},"o1eadd1e5d319d0d":{"_id":"o1eadd1e5d319d0d","component":"ToolBar","state":"init","action":"function init(conf) { \n  var toolBarItems = [],\n    self = this;\n\n  // items\n  toolBarItems = this.require('db').collections().ToolBarItem.find({\n    \"type\": this.designer().type()\n  });\n\n  // sort items\n  toolBarItems.sort(function (itemA, itemB) {\n    if (itemA.position > itemB.position) {\n      return 1;\n    }\n    if (itemA.position < itemB.position) {\n      return -1;\n    }\n    return 0;\n  });\n\n  toolBarItems.forEach(function (toolBarItem) {\n    var id = toolBarItem._id;\n    self.items().push(self.require(id));\n  });\n}","useCoreAPI":false,"core":false},"v165d9199c0111f0":{"_id":"v165d9199c0111f0","component":"ToolBar","state":"render","action":"function render() { \n  var domItems = document.getElementById('designer-toolbar-items'),\n    i = 0,\n    length = 0,\n    item = null,\n    self = this;\n\n  // items\n  this.items().forEach(function (item) {\n    domItems.insertAdjacentHTML('beforeend', '<li>' + item.html().source() + '</>');\n  });\n\n  // events\n  length = domItems.children.length;\n  for (i = 0; i < length; i++) {\n    item = domItems.children[i];\n    item.addEventListener('click', function () {\n      this.click();\n    }.bind(self.items(i)));\n  }\n}","useCoreAPI":false,"core":false},"s10dc61bf811b7d5":{"_id":"s10dc61bf811b7d5","component":"Workspace","state":"init","action":"function init(conf) { \n  var Editor = null,\n    designer = null,\n    editor = null;\n\n  Editor = this.require('Editor');\n  designer = this.require('designer');\n\n  if (designer.isCordova()) {\n    editor = new Editor({\n      '_id': 'editor',\n      'type': 'codemirror',\n      'context': 'type',\n      'editor': CodeMirror($('#designer-editor')[0], {\n        lineNumbers: true,\n        styleActiveLine: true,\n        'mode': 'application/json',\n        'theme': 'eclipse',\n        'tabSize': 2,\n        'autoCloseBrackets': true\n      })\n    });\n  } else {\n    editor = new Editor({\n      '_id': 'editor',\n      'type': 'ace',\n      'context': 'type',\n      'editor': ace.edit('designer-editor')\n    });\n  }\n}","useCoreAPI":false,"core":false},"w108111c7dc1ca6b":{"_id":"w108111c7dc1ca6b","component":"Workspace","state":"render","action":"function render() { \n  this.require('editor').render();\n}","useCoreAPI":false,"core":false},"u127e61b253119ab":{"_id":"u127e61b253119ab","component":"Server","state":"start","action":"function start() { \n  var RuntimeChannel = null,\n    channel = null,\n    id = '',\n    system = null,\n    designer = this.require('designer'),\n    editor = this.require('editor');\n\n  this.require('storage').on('changed', function (obj) {\n    if (typeof obj['system-designer-message'] !== 'undefined') {\n      $db.RuntimeMessage.insert(obj['system-designer-message'].newValue);\n    }\n  }, true);\n\n  RuntimeChannel = this.require('RuntimeChannel');\n  channel = new RuntimeChannel({\n    '_id': 'channel'\n  });\n\n  channel.on('send', function (message) {\n    if (message.event.indexOf('$system') !== 0) {\n      var config = this.require('storage').get('system-designer-config'),\n        designer = this.require('designer'),\n        messages = [];\n\n      if (designer.isCordova()) {\n        messages = designer.messages();\n        messages.push(message);\n        designer.messages(messages);\n      }\n\n      this.require('storage').set('system-designer-message', message);\n\n      // message for server debug\n      if (typeof config !== 'undefined' && typeof config.debugType !== 'undefined' && config.debugType === 'server' && config.urlServer) {\n        $.post(config.urlServer + ':8888/' + message.event, encodeURIComponent(JSON.stringify(message.data)));\n      }\n    }\n  });\n\n  id = document.location.href.split('#')[1].split('?')[0];\n  systemId = document.location.href.split('#')[2].split('?')[0];\n\n  system = this.require('storage').get(systemId);\n  type = system.types[id];\n\n  designer.store().uuid(id);\n  designer.store().data(type);\n\n  document.title = 'type ' + id + ' · system ' + system.name;\n\n  editor.initValue(JSON.stringify(type, null, '\\t'), 2);\n}","useCoreAPI":true,"core":false},"s1e0f61d1d3166b8":{"_id":"s1e0f61d1d3166b8","component":"Designer","state":"init","action":"function init(conf) { \n  var Store = null,\n    store = null,\n    MenuBar = null,\n    menubar = null,\n    ToolBar = null,\n    toolbar = null,\n    Workspace = null,\n    workspace = null,\n    Server = null,\n    server = null;\n\n  // type\n  this.type(window.location.href.split('.html')[0].split('/')[window.location.href.split('.html')[0].split('/').length - 1]);\n\n  // store\n  Store = this.require('Store');\n  store = new Store();\n\n  // menu\n  MenuBar = this.require('MenuBar');\n  menubar = new MenuBar({\n    designer: this\n  });\n  ToolBar = this.require('ToolBar');\n  toolbar = new ToolBar({\n    designer: this\n  });\n\n  // workspace\n  Workspace = this.require('Workspace');\n  workspace = new Workspace({\n    designer: this\n  });\n\n  // server\n  Server = this.require('Server');\n  server = new Server({\n    'designer': this\n  });\n\n  this.store(store);\n  this.menubar(menubar);\n  this.toolbar(toolbar);\n  this.workspace(workspace);\n  this.server(server);\n}","useCoreAPI":false,"core":false},"t17faa1c1e816821":{"_id":"t17faa1c1e816821","component":"Designer","state":"render","action":"function render() { \n  if (this.isCordova()) {\n    this.updateCordovaContext();\n  }\n  this.menubar().render();\n  this.toolbar().render();\n  this.workspace().render();\n  this.server().start();\n\n  this.updateRouter();\n\n  // TODO create a function\n  $(function () {\n    $('[data-toggle=\"tooltip\"]').tooltip({ 'container': 'body', delay: { \"show\": 1000, \"hide\": 100 } });\n  });\n}","useCoreAPI":false,"core":false},"m1952a1e3d1189f1":{"_id":"m1952a1e3d1189f1","component":"Designer","state":"updateRouter","action":"function updateRouter() { \n  var menubar = [],\n    i = 0,\n    length = 0,\n    id = '',\n    href = '';\n\n  id = decodeURIComponent(document.location.href.split('#')[1]);\n  collection = document.location.href.split('#')[2];\n\n  // update menubar\n  menubar = $('#designer-menubar-items > li > a');\n  length = menubar.length;\n  for (i = 0; i < length; i++) {\n    href = menubar[i].href;\n    context = href.split('#')[href.split('#').length - 1];\n    menubar[i].href = '#' + id + '#' + collection + '#' + context;\n  }\n}","useCoreAPI":false,"core":false},"b1db30135b014167":{"_id":"b1db30135b014167","component":"Designer","state":"clear","action":"function clear() { \n  this.refresh();\n}","useCoreAPI":false,"core":false},"m1cee1199cd158fd":{"_id":"m1cee1199cd158fd","component":"Designer","state":"context","action":"function context(value) { \n  this.workspace().clear();\n  this.workspace().refresh();\n}","useCoreAPI":false,"core":false},"y14257199751564c":{"_id":"y14257199751564c","component":"Designer","state":"save","action":"function save() { \n  var val = this.require('editor').getValue(),\n    type = null,\n    designer = this.require('designer'),\n    message = this.require('message');\n\n  try {\n    type = JSON.parse(val);\n  } catch (e) {\n    message.danger('Can not save your type: your type has an invalid structure.');\n    return;\n  }\n\n  if (!type.name) {\n    message.danger('The property \\'name\\' is missing.');\n    return;\n  }\n\n  if (!type.type) {\n    message.danger('The property \\'type\\' is missing.');\n    return;\n  }\n\n  if (type._id && type._id.indexOf(' ') !== -1) {\n    message.danger('Invalid \\'_id\\'. <br>Space is not authorized in the value of \\'_id\\'.');\n    return;\n  }\n\n  designer.store().data(type);\n\n  // check if ID change\n  if (designer.store().uuid() !== designer.store().data().name) {\n    this.require('channel').$editorDeleteType(designer.store().uuid());\n    designer.store().uuid(designer.store().data().name);\n\n    // update title\n    document.title = 'type ' + designer.store().uuid() + ' · ' + document.title.split('·')[1].trim();\n  }\n\n  this.require('channel').$editorUpdateType(designer.store().uuid(), designer.store().data());\n  message.clean();\n  message.success('Type saved.');\n}","useCoreAPI":false,"core":false},"r1df8d1a54e1c14f":{"_id":"r1df8d1a54e1c14f","component":"w1667a15e2a1e2ef","state":"start","action":"function start() { \n  var Designer = null,\n    designer = null;\n\n  Designer = this.require('Designer');\n  designer = new Designer({\n    '_id': 'designer'\n  });\n  designer.render();\n}","useCoreAPI":false,"core":false}},"types":{},"components":{},"_id":"w1667a15e2a1e2ef"}