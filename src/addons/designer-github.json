{"name":"designer-github","master":false,"subsystem":false,"version":"0.0.1","description":"","schemas":{"13bdf1ff1815d7c":{"_id":"13bdf1ff1815d7c","_name":"Github","_inherit":["RuntimeComponent"],"refresh":"method","push":"method"}},"models":{"1c23c1ed49186e9":{"_id":"1c23c1ed49186e9","_name":"Github","refresh":{},"push":{"params":[{"name":"comment","type":"string","mandatory":false,"default":""}]}}},"behaviors":{"1c2e3132fd18c75":{"_id":"1c2e3132fd18c75","component":"Github","state":"refresh","action":"function refresh() { \n  var config = {},\n      gh = null,\n      userName ='',\n      repository = '';\n\n  config = this.require('storage').get('system-designer-config');\n  if (config && config.githubToken && config.githubRepository) { \n\t\n\t  gh = new GitHub({\n      token: atob(config.githubToken)\n    });\n    \n    userName = config.githubRepository.split('/')[0];\n    repository = config.githubRepository.split('/')[1];\n    \n    repo = gh.getRepo(userName, repository);\n    \n    repo.getContents('master', '', 'raw')\n        .then(function (contents) {\n          contents.data.forEach(function (item) {\n            if (item.type === 'file' && item.name.indexOf('.json') !== -1) {\n              repo.getContents('master', item.name, 'raw')\n                  .then(function (content) {\n                    var system = content.data,\n                        systems = runtime.require('storage').get('system-designer-systems'),\n                        designer = runtime.require('designer'),\n                        System = runtime.require('System'),\n                        sys = null;\n                        \n                    delete system.classInfo;\n                    \n                    // save system\n                    runtime.require('storage').set(system._id, system);\n            \n                    // save index\n                    if (!systems ) {\n                        systems = { 'systems': [system._id] };\n                    } else {\n                        if (systems.systems.indexOf(system._id) === -1) {\n                            systems.systems.push(system._id);\n                        }\n                    }\n                    runtime.require('storage').set('system-designer-systems', systems);\n                    \n                    // refresh\n                    if (!designer.system()) {\n                      sys = new System(system);\n                      designer.system(sys);\n                      designer.space(sys.name());\n                    }\n                    \n                    designer.spaces().render();\n                    designer.workspace().refresh();\n                    designer.updateRouter();\n                   \n                    runtime.require('message').success('system ' + system.name  + ' updated.');\n                  })\n                  .catch(function (e){\n                    runtime.require('message').danger(e.response.data.message + '.');\n                  });\n            }\n          });  \n          \n          if (contents.data.length === 0) {\n            runtime.require('message').info('there is no system in your repository.');\n          }\n        })\n        .catch(function (e) {\n          runtime.require('message').danger(e.response.data.message + '.');\n        });\n  } else {\n    runtime.require('message').warning('no configuration found for Github.');\n  }\n}","useCoreAPI":false,"core":false},"11845140101e5ae":{"_id":"11845140101e5ae","component":"Github","state":"push","action":"function push(comment) { \n  var config = {},\n      gh = null,\n      userName ='',\n      repository = '',\n      designer = null,\n      system = {};\n\n  config = this.require('storage').get('system-designer-config');\n  if (config && config.githubToken && config.githubRepository) { \n\t\n\t  gh = new GitHub({\n      token: atob(config.githubToken)\n    });\n    \n    userName = config.githubRepository.split('/')[0];\n    repository = config.githubRepository.split('/')[1];\n    \n    designer = this.require('designer');\n    system = this.require('db').collections().System.find({\n      '_id': designer.system().id()\n    })[0];\n  \n    repo = gh.getRepo(userName, repository);\n    \n    repo.writeFile('master', system.name + '.json', JSON.stringify(system), comment || 'System Designer update', {})\n        .then(function () {\n          runtime.require('message').success('system pushed on github.');\n        })\n        .catch(function (e) {\n            runtime.require('message').danger(e.response.data.message + '.');\n        });\n  } else {\n    runtime.require('message').warning('no configuration found for Github');\n  }\n}","useCoreAPI":false,"core":false}},"types":{},"components":{"Github":{"github":{"_id":"github"}}},"_id":"1b9061a92113859"}